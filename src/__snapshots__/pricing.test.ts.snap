// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`computeAggregatedAndPriceTotals when coupons are applied should compute discounts and totals correctly for prices without tax 1`] = `
Object {
  "amount_subtotal": 7500,
  "amount_tax": 0,
  "amount_total": 7500,
  "currency": "EUR",
  "items": Array [
    Object {
      "_coupons": Array [
        Object {
          "_created_at": "2022-06-15T09:17:06.510Z",
          "_id": "coupon#1",
          "_org": "org#1",
          "_schema": "coupon",
          "_title": "Winter Sale",
          "_updated_at": "2022-06-17T11:48:20.104Z",
          "name": "Winter Sale",
          "percentage_value": "25",
          "type": "percentage",
        },
      ],
      "_price": Object {
        "_id": "price#1",
        "_title": "Winter Sale",
        "description": "Winter Sale",
        "is_tax_inclusive": true,
        "pricing_model": "per_unit",
        "tax": Array [],
        "type": "one_time",
        "unit_amount": 10000,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "100",
      },
      "_product": Object {
        "_tags": Array [
          "product-tag-1",
          "product-tag-2",
        ],
      },
      "amount_subtotal": 7500,
      "amount_subtotal_decimal": "75",
      "amount_tax": 0,
      "amount_total": 7500,
      "amount_total_decimal": "75",
      "before_discount_amount_total": 10000,
      "before_discount_amount_total_decimal": "100",
      "before_discount_tax_amount": 0,
      "before_discount_tax_amount_decimal": "0",
      "before_discount_unit_amount": 10000,
      "currency": "EUR",
      "description": "Winter Sale",
      "discount_amount": 2500,
      "discount_amount_decimal": "25",
      "discount_percentage": 25,
      "is_tax_inclusive": true,
      "price_id": "price#1",
      "pricing_model": "per_unit",
      "product_id": "prod-id#12324",
      "quantity": 1,
      "tax_discount_amount": 0,
      "tax_discount_amount_decimal": "0",
      "taxes": Array [
        Object {
          "amount": 0,
          "rate": "nontaxable",
          "rateValue": 0,
        },
      ],
      "unit_amount": 7500,
      "unit_amount_decimal": "100",
      "unit_amount_gross": 7500,
      "unit_amount_gross_decimal": "75",
      "unit_amount_net": 7500,
      "unit_amount_net_decimal": "75",
      "unit_discount_amount": 2500,
      "unit_discount_amount_decimal": "25",
      "unit_discount_amount_net": 2500,
      "unit_discount_amount_net_decimal": "25",
    },
  ],
  "total_details": Object {
    "amount_tax": 0,
    "breakdown": Object {
      "recurrences": Array [
        Object {
          "amount_subtotal": 7500,
          "amount_subtotal_decimal": "75",
          "amount_tax": 0,
          "amount_total": 7500,
          "amount_total_decimal": "75",
          "before_discount_amount_total": 10000,
          "before_discount_amount_total_decimal": "100",
          "discount_amount": 2500,
          "discount_amount_decimal": "25",
          "type": "one_time",
          "unit_amount_gross": 7500,
          "unit_amount_net": 7500,
        },
      ],
      "recurrencesByTax": Array [
        Object {
          "amount_subtotal": 7500,
          "amount_tax": 0,
          "amount_total": 7500,
          "tax": Object {
            "amount": 0,
            "tax": Object {
              "rate": 0,
            },
          },
          "type": "one_time",
        },
      ],
      "taxes": Array [
        Object {
          "amount": 0,
          "tax": Object {
            "rate": 0,
          },
        },
      ],
    },
  },
}
`;

exports[`computeAggregatedAndPriceTotals when coupons are applied should compute discounts and totals correctly when there are multiple prices 1`] = `
Object {
  "amount_subtotal": 388980375,
  "amount_tax": 1364,
  "amount_total": 388981739,
  "currency": "EUR",
  "items": Array [
    Object {
      "_coupons": Array [
        Object {
          "_created_at": "2022-06-15T09:17:06.510Z",
          "_id": "coupon#1",
          "_org": "org#1",
          "_schema": "coupon",
          "_title": "Winter Sale",
          "_updated_at": "2022-06-17T11:48:20.104Z",
          "name": "Winter Sale",
          "percentage_value": "25",
          "type": "percentage",
        },
      ],
      "_price": Object {
        "_id": "price#1",
        "_title": "Winter Sale",
        "description": "Winter Sale",
        "is_tax_inclusive": true,
        "pricing_model": "per_unit",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "10",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 10,
            "type": "VAT",
          },
        ],
        "type": "one_time",
        "unit_amount": 10000,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "100",
      },
      "_product": Object {
        "_tags": Array [
          "product-tag-1",
          "product-tag-2",
        ],
      },
      "amount_subtotal": 6818,
      "amount_subtotal_decimal": "68.181818181818",
      "amount_tax": 682,
      "amount_total": 7500,
      "amount_total_decimal": "75",
      "before_discount_amount_total": 10000,
      "before_discount_amount_total_decimal": "100",
      "before_discount_tax_amount": 909,
      "before_discount_tax_amount_decimal": "9.090909090909",
      "before_discount_unit_amount": 10000,
      "currency": "EUR",
      "description": "Winter Sale",
      "discount_amount": 2500,
      "discount_amount_decimal": "25",
      "discount_percentage": 25,
      "is_tax_inclusive": true,
      "price_id": "price#1",
      "pricing_model": "per_unit",
      "product_id": "prod-id#12324",
      "quantity": 1,
      "tax_discount_amount": 227,
      "tax_discount_amount_decimal": "2.272727272727",
      "taxes": Array [
        Object {
          "amount": 682,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "10",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 10,
            "type": "VAT",
          },
        },
      ],
      "unit_amount": 7500,
      "unit_amount_decimal": "100",
      "unit_amount_gross": 7500,
      "unit_amount_gross_decimal": "75",
      "unit_amount_net": 6818,
      "unit_amount_net_decimal": "68.181818181818",
      "unit_discount_amount": 2500,
      "unit_discount_amount_decimal": "25",
      "unit_discount_amount_net": 2273,
      "unit_discount_amount_net_decimal": "22.727272727273",
    },
    Object {
      "_coupons": Array [
        Object {
          "_created_at": "2022-06-15T09:17:06.510Z",
          "_id": "coupon#1",
          "_org": "org#1",
          "_schema": "coupon",
          "_title": "Winter Sale",
          "_updated_at": "2022-06-17T11:48:20.104Z",
          "name": "Winter Sale",
          "percentage_value": "25",
          "type": "percentage",
        },
      ],
      "_price": Object {
        "_id": "price#1",
        "_title": "Winter Sale",
        "description": "Winter Sale",
        "is_tax_inclusive": true,
        "pricing_model": "per_unit",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "10",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 10,
            "type": "VAT",
          },
        ],
        "type": "one_time",
        "unit_amount": 10000,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "100",
      },
      "_product": Object {
        "_tags": Array [
          "product-tag-1",
          "product-tag-2",
        ],
      },
      "amount_subtotal": 6818,
      "amount_subtotal_decimal": "68.181818181818",
      "amount_tax": 682,
      "amount_total": 7500,
      "amount_total_decimal": "75",
      "before_discount_amount_total": 10000,
      "before_discount_amount_total_decimal": "100",
      "before_discount_tax_amount": 909,
      "before_discount_tax_amount_decimal": "9.090909090909",
      "before_discount_unit_amount": 10000,
      "currency": "EUR",
      "description": "Winter Sale",
      "discount_amount": 2500,
      "discount_amount_decimal": "25",
      "discount_percentage": 25,
      "is_tax_inclusive": true,
      "price_id": "price#1",
      "pricing_model": "per_unit",
      "product_id": "prod-id#12324",
      "quantity": 1,
      "tax_discount_amount": 227,
      "tax_discount_amount_decimal": "2.272727272727",
      "taxes": Array [
        Object {
          "amount": 682,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "10",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 10,
            "type": "VAT",
          },
        },
      ],
      "unit_amount": 7500,
      "unit_amount_decimal": "100",
      "unit_amount_gross": 7500,
      "unit_amount_gross_decimal": "75",
      "unit_amount_net": 6818,
      "unit_amount_net_decimal": "68.181818181818",
      "unit_discount_amount": 2500,
      "unit_discount_amount_decimal": "25",
      "unit_discount_amount_net": 2273,
      "unit_discount_amount_net_decimal": "22.727272727273",
    },
    Object {
      "_price": Object {
        "_id": "adbd8cee-0db2-41dd-b93b-2d0ed57c77da",
        "_title": "As Starting Price One Time No Tax",
        "active": true,
        "billing_duration_unit": "months",
        "billing_period": "weekly",
        "description": "As Starting Price One Time No Tax",
        "is_tax_inclusive": true,
        "notice_time_unit": "months",
        "price_display_in_journeys": "show_as_starting_price",
        "pricing_model": "per_unit",
        "renewal_duration_unit": "months",
        "sales_tax": "standard",
        "tax": undefined,
        "termination_time_unit": "months",
        "type": "one_time",
        "unit_amount": 55566677,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "555666.77",
      },
      "_product": Object {
        "_id": "11bd46e5-4c02-425c-bcce-5f5e022a2b45",
        "_title": "Product With A Lot Of Prices - Do Not Change üôè",
        "name": "Product With A Lot Of Prices - Do Not Change üôè",
        "price_options": Object {
          "$relation": Array [
            Object {
              "entity_id": "f850ebff-082e-4924-8631-965cc9c0ab2b",
            },
            Object {
              "entity_id": "d6ecc576-b5d6-44b4-8c95-496ab2ac14d3",
            },
            Object {
              "entity_id": "3c0e47ad-6ca3-4cd8-b6b4-b2a48dab7f16",
            },
            Object {
              "entity_id": "adbd8cee-0db2-41dd-b93b-2d0ed57c77da",
            },
            Object {
              "entity_id": "3e97f809-1d4b-47e1-9faf-46386b2b0d21",
            },
            Object {
              "entity_id": "d4061656-71dc-45ec-bf6c-1d90d2419d87",
            },
            Object {
              "entity_id": "4ae4221b-4fd0-4bcc-98a2-f20cda954903",
            },
            Object {
              "entity_id": "b326df19-9d0f-433a-a4d2-a0a65034b5f7",
            },
            Object {
              "entity_id": "0d071551-47be-4a5b-90d7-d425a59607e6",
            },
          ],
        },
        "type": "product",
      },
      "amount_subtotal": 388966739,
      "amount_subtotal_decimal": "3889667.39",
      "amount_tax": 0,
      "amount_total": 388966739,
      "amount_total_decimal": "3889667.39",
      "currency": "EUR",
      "description": "As Starting Price One Time No Tax",
      "is_tax_inclusive": true,
      "price_id": "adbd8cee-0db2-41dd-b93b-2d0ed57c77da",
      "pricing_model": "per_unit",
      "product_id": "11bd46e5-4c02-425c-bcce-5f5e022a2b45",
      "quantity": 7,
      "taxes": Array [
        Object {
          "amount": 0,
          "rate": "nontaxable",
          "rateValue": 0,
        },
      ],
      "unit_amount": 55566677,
      "unit_amount_decimal": "555666.77",
      "unit_amount_gross": 55566677,
      "unit_amount_gross_decimal": "555666.77",
      "unit_amount_net": 55566677,
      "unit_amount_net_decimal": "555666.77",
    },
  ],
  "total_details": Object {
    "amount_tax": 1364,
    "breakdown": Object {
      "recurrences": Array [
        Object {
          "amount_subtotal": 388980375,
          "amount_subtotal_decimal": "3889803.753636364",
          "amount_tax": 1364,
          "amount_total": 388981739,
          "amount_total_decimal": "3889817.39",
          "before_discount_amount_total": 20000,
          "before_discount_amount_total_decimal": "200",
          "discount_amount": 5000,
          "discount_amount_decimal": "50",
          "type": "one_time",
          "unit_amount_gross": 55581677,
          "unit_amount_net": 55580313,
        },
      ],
      "recurrencesByTax": Array [
        Object {
          "amount_subtotal": 388980375,
          "amount_tax": 1364,
          "amount_total": 388981739,
          "tax": Object {
            "amount": 1364,
            "tax": Object {
              "_id": "10",
              "rate": 10,
              "type": "VAT",
            },
          },
          "type": "one_time",
        },
      ],
      "taxes": Array [
        Object {
          "amount": 1364,
          "tax": Object {
            "_id": "10",
            "rate": 10,
            "type": "VAT",
          },
        },
        Object {
          "amount": 0,
          "tax": Object {
            "rate": 0,
          },
        },
      ],
    },
  },
}
`;

exports[`computeAggregatedAndPriceTotals when coupons are applied should compute discounts and totals correctly when there is a fixed discount coupon and quantity is higher than 1 1`] = `
Object {
  "amount_subtotal": 43182,
  "amount_tax": 4318,
  "amount_total": 47500,
  "currency": "EUR",
  "items": Array [
    Object {
      "_coupons": Array [
        Object {
          "_created_at": "2022-06-15T09:17:06.510Z",
          "_id": "coupon#2",
          "_org": "org#1",
          "_schema": "coupon",
          "_title": "Winter Sale",
          "_updated_at": "2022-06-17T11:48:20.104Z",
          "fixed_value": 500,
          "fixed_value_currency": "EUR",
          "fixed_value_decimal": "5.00",
          "name": "Winter Sale",
          "type": "fixed",
        },
      ],
      "_price": Object {
        "_id": "price#1",
        "_title": "Winter Sale",
        "description": "Winter Sale",
        "is_tax_inclusive": true,
        "pricing_model": "per_unit",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "10",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 10,
            "type": "VAT",
          },
        ],
        "type": "one_time",
        "unit_amount": 10000,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "100",
      },
      "_product": Object {
        "_tags": Array [
          "product-tag-1",
          "product-tag-2",
        ],
      },
      "amount_subtotal": 43182,
      "amount_subtotal_decimal": "431.81818181818",
      "amount_tax": 4318,
      "amount_total": 47500,
      "amount_total_decimal": "475",
      "before_discount_amount_total": 50000,
      "before_discount_amount_total_decimal": "500",
      "before_discount_tax_amount": 4545,
      "before_discount_tax_amount_decimal": "45.454545454545",
      "before_discount_unit_amount": 10000,
      "currency": "EUR",
      "description": "Winter Sale",
      "discount_amount": 2500,
      "discount_amount_decimal": "25",
      "discount_percentage": undefined,
      "is_tax_inclusive": true,
      "price_id": "price#1",
      "pricing_model": "per_unit",
      "product_id": "prod-id#12324",
      "quantity": 5,
      "tax_discount_amount": 227,
      "tax_discount_amount_decimal": "2.272727272725",
      "taxes": Array [
        Object {
          "amount": 4318,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "10",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 10,
            "type": "VAT",
          },
        },
      ],
      "unit_amount": 9500,
      "unit_amount_decimal": "100",
      "unit_amount_gross": 9500,
      "unit_amount_gross_decimal": "95",
      "unit_amount_net": 8636,
      "unit_amount_net_decimal": "86.363636363636",
      "unit_discount_amount": 500,
      "unit_discount_amount_decimal": "5",
      "unit_discount_amount_net": 455,
      "unit_discount_amount_net_decimal": "4.545454545455",
    },
  ],
  "total_details": Object {
    "amount_tax": 4318,
    "breakdown": Object {
      "recurrences": Array [
        Object {
          "amount_subtotal": 43182,
          "amount_subtotal_decimal": "431.81818181818",
          "amount_tax": 4318,
          "amount_total": 47500,
          "amount_total_decimal": "475",
          "before_discount_amount_total": 50000,
          "before_discount_amount_total_decimal": "500",
          "discount_amount": 2500,
          "discount_amount_decimal": "25",
          "type": "one_time",
          "unit_amount_gross": 9500,
          "unit_amount_net": 8636,
        },
      ],
      "recurrencesByTax": Array [
        Object {
          "amount_subtotal": 43182,
          "amount_tax": 4318,
          "amount_total": 47500,
          "tax": Object {
            "amount": 4318,
            "tax": Object {
              "_id": "10",
              "rate": 10,
              "type": "VAT",
            },
          },
          "type": "one_time",
        },
      ],
      "taxes": Array [
        Object {
          "amount": 4318,
          "tax": Object {
            "_id": "10",
            "rate": 10,
            "type": "VAT",
          },
        },
      ],
    },
  },
}
`;

exports[`computeAggregatedAndPriceTotals when coupons are applied should compute discounts and totals correctly when there is a fixed-amount discount coupon 1`] = `
Object {
  "amount_subtotal": 8636,
  "amount_tax": 864,
  "amount_total": 9500,
  "currency": "EUR",
  "items": Array [
    Object {
      "_coupons": Array [
        Object {
          "_created_at": "2022-06-15T09:17:06.510Z",
          "_id": "coupon#2",
          "_org": "org#1",
          "_schema": "coupon",
          "_title": "Winter Sale",
          "_updated_at": "2022-06-17T11:48:20.104Z",
          "fixed_value": 500,
          "fixed_value_currency": "EUR",
          "fixed_value_decimal": "5.00",
          "name": "Winter Sale",
          "type": "fixed",
        },
      ],
      "_price": Object {
        "_id": "price#1",
        "_title": "Winter Sale",
        "description": "Winter Sale",
        "is_tax_inclusive": true,
        "pricing_model": "per_unit",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "10",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 10,
            "type": "VAT",
          },
        ],
        "type": "one_time",
        "unit_amount": 10000,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "100",
      },
      "_product": Object {
        "_tags": Array [
          "product-tag-1",
          "product-tag-2",
        ],
      },
      "amount_subtotal": 8636,
      "amount_subtotal_decimal": "86.363636363636",
      "amount_tax": 864,
      "amount_total": 9500,
      "amount_total_decimal": "95",
      "before_discount_amount_total": 10000,
      "before_discount_amount_total_decimal": "100",
      "before_discount_tax_amount": 909,
      "before_discount_tax_amount_decimal": "9.090909090909",
      "before_discount_unit_amount": 10000,
      "currency": "EUR",
      "description": "Winter Sale",
      "discount_amount": 500,
      "discount_amount_decimal": "5",
      "discount_percentage": undefined,
      "is_tax_inclusive": true,
      "price_id": "price#1",
      "pricing_model": "per_unit",
      "product_id": "prod-id#12324",
      "quantity": 1,
      "tax_discount_amount": 45,
      "tax_discount_amount_decimal": "0.454545454545",
      "taxes": Array [
        Object {
          "amount": 864,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "10",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 10,
            "type": "VAT",
          },
        },
      ],
      "unit_amount": 9500,
      "unit_amount_decimal": "100",
      "unit_amount_gross": 9500,
      "unit_amount_gross_decimal": "95",
      "unit_amount_net": 8636,
      "unit_amount_net_decimal": "86.363636363636",
      "unit_discount_amount": 500,
      "unit_discount_amount_decimal": "5",
      "unit_discount_amount_net": 455,
      "unit_discount_amount_net_decimal": "4.545454545455",
    },
  ],
  "total_details": Object {
    "amount_tax": 864,
    "breakdown": Object {
      "recurrences": Array [
        Object {
          "amount_subtotal": 8636,
          "amount_subtotal_decimal": "86.363636363636",
          "amount_tax": 864,
          "amount_total": 9500,
          "amount_total_decimal": "95",
          "before_discount_amount_total": 10000,
          "before_discount_amount_total_decimal": "100",
          "discount_amount": 500,
          "discount_amount_decimal": "5",
          "type": "one_time",
          "unit_amount_gross": 9500,
          "unit_amount_net": 8636,
        },
      ],
      "recurrencesByTax": Array [
        Object {
          "amount_subtotal": 8636,
          "amount_tax": 864,
          "amount_total": 9500,
          "tax": Object {
            "amount": 864,
            "tax": Object {
              "_id": "10",
              "rate": 10,
              "type": "VAT",
            },
          },
          "type": "one_time",
        },
      ],
      "taxes": Array [
        Object {
          "amount": 864,
          "tax": Object {
            "_id": "10",
            "rate": 10,
            "type": "VAT",
          },
        },
      ],
    },
  },
}
`;

exports[`computeAggregatedAndPriceTotals when coupons are applied should compute discounts and totals correctly when there is a percentage discount coupon 1`] = `
Object {
  "amount_subtotal": 6818,
  "amount_tax": 682,
  "amount_total": 7500,
  "currency": "EUR",
  "items": Array [
    Object {
      "_coupons": Array [
        Object {
          "_created_at": "2022-06-15T09:17:06.510Z",
          "_id": "coupon#1",
          "_org": "org#1",
          "_schema": "coupon",
          "_title": "Winter Sale",
          "_updated_at": "2022-06-17T11:48:20.104Z",
          "name": "Winter Sale",
          "percentage_value": "25",
          "type": "percentage",
        },
      ],
      "_price": Object {
        "_id": "price#1",
        "_title": "Winter Sale",
        "description": "Winter Sale",
        "is_tax_inclusive": true,
        "pricing_model": "per_unit",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "10",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 10,
            "type": "VAT",
          },
        ],
        "type": "one_time",
        "unit_amount": 10000,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "100",
      },
      "_product": Object {
        "_tags": Array [
          "product-tag-1",
          "product-tag-2",
        ],
      },
      "amount_subtotal": 6818,
      "amount_subtotal_decimal": "68.181818181818",
      "amount_tax": 682,
      "amount_total": 7500,
      "amount_total_decimal": "75",
      "before_discount_amount_total": 10000,
      "before_discount_amount_total_decimal": "100",
      "before_discount_tax_amount": 909,
      "before_discount_tax_amount_decimal": "9.090909090909",
      "before_discount_unit_amount": 10000,
      "currency": "EUR",
      "description": "Winter Sale",
      "discount_amount": 2500,
      "discount_amount_decimal": "25",
      "discount_percentage": 25,
      "is_tax_inclusive": true,
      "price_id": "price#1",
      "pricing_model": "per_unit",
      "product_id": "prod-id#12324",
      "quantity": 1,
      "tax_discount_amount": 227,
      "tax_discount_amount_decimal": "2.272727272727",
      "taxes": Array [
        Object {
          "amount": 682,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "10",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 10,
            "type": "VAT",
          },
        },
      ],
      "unit_amount": 7500,
      "unit_amount_decimal": "100",
      "unit_amount_gross": 7500,
      "unit_amount_gross_decimal": "75",
      "unit_amount_net": 6818,
      "unit_amount_net_decimal": "68.181818181818",
      "unit_discount_amount": 2500,
      "unit_discount_amount_decimal": "25",
      "unit_discount_amount_net": 2273,
      "unit_discount_amount_net_decimal": "22.727272727273",
    },
  ],
  "total_details": Object {
    "amount_tax": 682,
    "breakdown": Object {
      "recurrences": Array [
        Object {
          "amount_subtotal": 6818,
          "amount_subtotal_decimal": "68.181818181818",
          "amount_tax": 682,
          "amount_total": 7500,
          "amount_total_decimal": "75",
          "before_discount_amount_total": 10000,
          "before_discount_amount_total_decimal": "100",
          "discount_amount": 2500,
          "discount_amount_decimal": "25",
          "type": "one_time",
          "unit_amount_gross": 7500,
          "unit_amount_net": 6818,
        },
      ],
      "recurrencesByTax": Array [
        Object {
          "amount_subtotal": 6818,
          "amount_tax": 682,
          "amount_total": 7500,
          "tax": Object {
            "amount": 682,
            "tax": Object {
              "_id": "10",
              "rate": 10,
              "type": "VAT",
            },
          },
          "type": "one_time",
        },
      ],
      "taxes": Array [
        Object {
          "amount": 682,
          "tax": Object {
            "_id": "10",
            "rate": 10,
            "type": "VAT",
          },
        },
      ],
    },
  },
}
`;

exports[`computeAggregatedAndPriceTotals when coupons are applied should compute discounts and totals correctly when there is a percentage discount coupon 2`] = `
Object {
  "amount_subtotal": 7500,
  "amount_tax": 750,
  "amount_total": 8250,
  "currency": "EUR",
  "items": Array [
    Object {
      "_coupons": Array [
        Object {
          "_created_at": "2022-06-15T09:17:06.510Z",
          "_id": "coupon#1",
          "_org": "org#1",
          "_schema": "coupon",
          "_title": "Winter Sale",
          "_updated_at": "2022-06-17T11:48:20.104Z",
          "name": "Winter Sale",
          "percentage_value": "25",
          "type": "percentage",
        },
      ],
      "_price": Object {
        "_id": "price#1",
        "_title": "Winter Sale",
        "description": "Winter Sale",
        "is_tax_inclusive": false,
        "pricing_model": "per_unit",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "10",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 10,
            "type": "VAT",
          },
        ],
        "type": "one_time",
        "unit_amount": 10000,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "100",
      },
      "_product": Object {
        "_tags": Array [
          "product-tag-1",
          "product-tag-2",
        ],
      },
      "amount_subtotal": 7500,
      "amount_subtotal_decimal": "75",
      "amount_tax": 750,
      "amount_total": 8250,
      "amount_total_decimal": "82.5",
      "before_discount_amount_total": 11000,
      "before_discount_amount_total_decimal": "110",
      "before_discount_tax_amount": 1000,
      "before_discount_tax_amount_decimal": "10",
      "before_discount_unit_amount": 10000,
      "currency": "EUR",
      "description": "Winter Sale",
      "discount_amount": 2500,
      "discount_amount_decimal": "25",
      "discount_percentage": 25,
      "is_tax_inclusive": false,
      "price_id": "price#1",
      "pricing_model": "per_unit",
      "product_id": "prod-id#12324",
      "quantity": 1,
      "tax_discount_amount": 0,
      "tax_discount_amount_decimal": "0",
      "taxes": Array [
        Object {
          "amount": 750,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "10",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 10,
            "type": "VAT",
          },
        },
      ],
      "unit_amount": 7500,
      "unit_amount_decimal": "100",
      "unit_amount_gross": 8250,
      "unit_amount_gross_decimal": "82.5",
      "unit_amount_net": 7500,
      "unit_amount_net_decimal": "75",
      "unit_discount_amount": 2500,
      "unit_discount_amount_decimal": "25",
      "unit_discount_amount_net": 2500,
      "unit_discount_amount_net_decimal": "25",
    },
  ],
  "total_details": Object {
    "amount_tax": 750,
    "breakdown": Object {
      "recurrences": Array [
        Object {
          "amount_subtotal": 7500,
          "amount_subtotal_decimal": "75",
          "amount_tax": 750,
          "amount_total": 8250,
          "amount_total_decimal": "82.5",
          "before_discount_amount_total": 11000,
          "before_discount_amount_total_decimal": "110",
          "discount_amount": 2500,
          "discount_amount_decimal": "25",
          "type": "one_time",
          "unit_amount_gross": 8250,
          "unit_amount_net": 7500,
        },
      ],
      "recurrencesByTax": Array [
        Object {
          "amount_subtotal": 7500,
          "amount_tax": 750,
          "amount_total": 8250,
          "tax": Object {
            "amount": 750,
            "tax": Object {
              "_id": "10",
              "rate": 10,
              "type": "VAT",
            },
          },
          "type": "one_time",
        },
      ],
      "taxes": Array [
        Object {
          "amount": 750,
          "tax": Object {
            "_id": "10",
            "rate": 10,
            "type": "VAT",
          },
        },
      ],
    },
  },
}
`;

exports[`computeAggregatedAndPriceTotals when coupons are applied should compute discounts and totals correctly when there is a percentage discount coupon and quantity is higher than 1 1`] = `
Object {
  "amount_subtotal": 34091,
  "amount_tax": 3409,
  "amount_total": 37500,
  "currency": "EUR",
  "items": Array [
    Object {
      "_coupons": Array [
        Object {
          "_created_at": "2022-06-15T09:17:06.510Z",
          "_id": "coupon#1",
          "_org": "org#1",
          "_schema": "coupon",
          "_title": "Winter Sale",
          "_updated_at": "2022-06-17T11:48:20.104Z",
          "name": "Winter Sale",
          "percentage_value": "25",
          "type": "percentage",
        },
      ],
      "_price": Object {
        "_id": "price#1",
        "_title": "Winter Sale",
        "description": "Winter Sale",
        "is_tax_inclusive": true,
        "pricing_model": "per_unit",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "10",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 10,
            "type": "VAT",
          },
        ],
        "type": "one_time",
        "unit_amount": 10000,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "100",
      },
      "_product": Object {
        "_tags": Array [
          "product-tag-1",
          "product-tag-2",
        ],
      },
      "amount_subtotal": 34091,
      "amount_subtotal_decimal": "340.90909090909",
      "amount_tax": 3409,
      "amount_total": 37500,
      "amount_total_decimal": "375",
      "before_discount_amount_total": 50000,
      "before_discount_amount_total_decimal": "500",
      "before_discount_tax_amount": 4545,
      "before_discount_tax_amount_decimal": "45.454545454545",
      "before_discount_unit_amount": 10000,
      "currency": "EUR",
      "description": "Winter Sale",
      "discount_amount": 12500,
      "discount_amount_decimal": "125",
      "discount_percentage": 25,
      "is_tax_inclusive": true,
      "price_id": "price#1",
      "pricing_model": "per_unit",
      "product_id": "prod-id#12324",
      "quantity": 5,
      "tax_discount_amount": 1136,
      "tax_discount_amount_decimal": "11.363636363635",
      "taxes": Array [
        Object {
          "amount": 3409,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "10",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 10,
            "type": "VAT",
          },
        },
      ],
      "unit_amount": 7500,
      "unit_amount_decimal": "100",
      "unit_amount_gross": 7500,
      "unit_amount_gross_decimal": "75",
      "unit_amount_net": 6818,
      "unit_amount_net_decimal": "68.181818181818",
      "unit_discount_amount": 2500,
      "unit_discount_amount_decimal": "25",
      "unit_discount_amount_net": 2273,
      "unit_discount_amount_net_decimal": "22.727272727273",
    },
  ],
  "total_details": Object {
    "amount_tax": 3409,
    "breakdown": Object {
      "recurrences": Array [
        Object {
          "amount_subtotal": 34091,
          "amount_subtotal_decimal": "340.90909090909",
          "amount_tax": 3409,
          "amount_total": 37500,
          "amount_total_decimal": "375",
          "before_discount_amount_total": 50000,
          "before_discount_amount_total_decimal": "500",
          "discount_amount": 12500,
          "discount_amount_decimal": "125",
          "type": "one_time",
          "unit_amount_gross": 7500,
          "unit_amount_net": 6818,
        },
      ],
      "recurrencesByTax": Array [
        Object {
          "amount_subtotal": 34091,
          "amount_tax": 3409,
          "amount_total": 37500,
          "tax": Object {
            "amount": 3409,
            "tax": Object {
              "_id": "10",
              "rate": 10,
              "type": "VAT",
            },
          },
          "type": "one_time",
        },
      ],
      "taxes": Array [
        Object {
          "amount": 3409,
          "tax": Object {
            "_id": "10",
            "rate": 10,
            "type": "VAT",
          },
        },
      ],
    },
  },
}
`;

exports[`computeAggregatedAndPriceTotals when is_composite_price = false should return the right result when the price is not provided  1`] = `
Object {
  "amount_subtotal": 0,
  "amount_tax": 0,
  "amount_total": 0,
  "currency": "EUR",
  "items": Array [
    Object {
      "_price": Object {
        "pricing_model": "per_unit",
      },
      "amount_subtotal": 0,
      "amount_subtotal_decimal": "0",
      "amount_tax": 0,
      "amount_total": 0,
      "amount_total_decimal": "0",
      "currency": "EUR",
      "is_tax_inclusive": true,
      "price_id": "price#1",
      "pricing_model": "tiered_volume",
      "product_id": "prod-id#12324",
      "quantity": 5,
      "taxes": Array [
        Object {
          "amount": 0,
          "rate": "nontaxable",
          "rateValue": 0,
        },
      ],
      "unit_amount": 0,
      "unit_amount_decimal": "0.0",
      "unit_amount_gross": 0,
      "unit_amount_gross_decimal": "0",
      "unit_amount_net": 0,
      "unit_amount_net_decimal": "0",
    },
  ],
  "total_details": Object {
    "amount_tax": 0,
    "breakdown": Object {
      "recurrences": Array [
        Object {
          "amount_subtotal": 0,
          "amount_subtotal_decimal": "0",
          "amount_tax": 0,
          "amount_total": 0,
          "amount_total_decimal": "0",
          "type": "one_time",
          "unit_amount_gross": 0,
          "unit_amount_net": 0,
        },
      ],
      "recurrencesByTax": Array [
        Object {
          "amount_subtotal": 0,
          "amount_tax": 0,
          "amount_total": 0,
          "tax": Object {
            "amount": 0,
            "tax": Object {
              "rate": 0,
            },
          },
          "type": "one_time",
        },
      ],
      "taxes": Array [
        Object {
          "amount": 0,
          "tax": Object {
            "rate": 0,
          },
        },
      ],
    },
  },
}
`;

exports[`computeAggregatedAndPriceTotals when is_composite_price = false should return the right result when there are several items per recurrence 1`] = `
Object {
  "amount_subtotal": 736609,
  "amount_tax": 136317,
  "amount_total": 872926,
  "currency": "EUR",
  "items": Array [
    Object {
      "_price": Object {
        "_id": "price#1",
        "_title": "Winter Sale",
        "description": "Winter Sale",
        "is_tax_inclusive": true,
        "pricing_model": "per_unit",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        ],
        "type": "one_time",
        "unit_amount": 78946,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "789.456224456678",
      },
      "_product": Object {
        "_tags": Array [
          "product-tag-1",
          "product-tag-2",
        ],
      },
      "amount_subtotal": 331704,
      "amount_subtotal_decimal": "3317.04295990201",
      "amount_tax": 63024,
      "amount_total": 394728,
      "amount_total_decimal": "3947.28112228339",
      "currency": "EUR",
      "description": "Winter Sale",
      "is_tax_inclusive": true,
      "price_id": "price#1",
      "pricing_model": "per_unit",
      "product_id": "prod-id#12324",
      "quantity": 5,
      "taxes": Array [
        Object {
          "amount": 63024,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        },
      ],
      "unit_amount": 78946,
      "unit_amount_decimal": "789.456224456678",
      "unit_amount_gross": 78946,
      "unit_amount_gross_decimal": "789.456224456678",
      "unit_amount_net": 66341,
      "unit_amount_net_decimal": "663.408591980402",
    },
    Object {
      "_price": Object {
        "_id": "price#2",
        "_title": "Winter Lease",
        "billing_duration_amount": 1,
        "billing_duration_unit": "years",
        "billing_period": "monthly",
        "description": "Winter Lease",
        "is_tax_inclusive": true,
        "notice_time_amount": 1,
        "notice_time_unit": "months",
        "pricing_model": "per_unit",
        "renewal_duration_amount": 1,
        "renewal_duration_unit": "years",
        "sales_tax": "standard",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        ],
        "termination_time_amount": 2,
        "termination_time_unit": "weeks",
        "type": "recurring",
        "unit_amount": 3447,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "34.456224456678",
      },
      "_product": Object {},
      "amount_subtotal": 2895,
      "amount_subtotal_decimal": "28.954810467797",
      "amount_tax": 550,
      "amount_total": 3446,
      "amount_total_decimal": "34.456224456678",
      "currency": "EUR",
      "description": "Winter Lease",
      "is_tax_inclusive": true,
      "price_id": "price#2",
      "pricing_model": "per_unit",
      "product_id": "prod-id#12324",
      "quantity": 1,
      "taxes": Array [
        Object {
          "amount": 550,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        },
      ],
      "unit_amount": 3446,
      "unit_amount_decimal": "34.456224456678",
      "unit_amount_gross": 3446,
      "unit_amount_gross_decimal": "34.456224456678",
      "unit_amount_net": 2895,
      "unit_amount_net_decimal": "28.954810467797",
    },
    Object {
      "_price": Object {
        "_id": "price#3",
        "_tags": Array [
          "price-tag-1",
          "price-tag-2",
        ],
        "_title": "Winter Lease",
        "billing_duration_amount": 1,
        "billing_duration_unit": "years",
        "billing_period": "yearly",
        "description": "Winter Lease",
        "is_tax_inclusive": false,
        "notice_time_amount": 1,
        "notice_time_unit": "months",
        "pricing_model": "per_unit",
        "renewal_duration_amount": 1,
        "renewal_duration_unit": "years",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "6",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 6,
            "type": "VAT",
          },
        ],
        "termination_time_amount": 2,
        "termination_time_unit": "weeks",
        "type": "recurring",
        "unit_amount": 4546,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "45.456224456678",
      },
      "_product": Object {},
      "amount_subtotal": 13637,
      "amount_subtotal_decimal": "136.368673370034",
      "amount_tax": 818,
      "amount_total": 14455,
      "amount_total_decimal": "144.550793772237",
      "currency": "EUR",
      "description": "Winter Lease",
      "is_tax_inclusive": false,
      "price_id": "price#3",
      "pricing_model": "per_unit",
      "product_id": "prod-id#12324",
      "quantity": 3,
      "taxes": Array [
        Object {
          "amount": 818,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "6",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 6,
            "type": "VAT",
          },
        },
      ],
      "unit_amount": 4546,
      "unit_amount_decimal": "45.456224456678",
      "unit_amount_gross": 4818,
      "unit_amount_gross_decimal": "48.183597924079",
      "unit_amount_net": 4546,
      "unit_amount_net_decimal": "45.456224456678",
    },
    Object {
      "_price": Object {
        "_id": "price#1",
        "_title": "Winter Sale",
        "description": "Winter Sale",
        "is_tax_inclusive": true,
        "pricing_model": "per_unit",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        ],
        "type": "one_time",
        "unit_amount": 78946,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "789.456224456678",
      },
      "_product": Object {},
      "amount_subtotal": 331704,
      "amount_subtotal_decimal": "3317.04295990201",
      "amount_tax": 63024,
      "amount_total": 394728,
      "amount_total_decimal": "3947.28112228339",
      "currency": "EUR",
      "description": "Winter Sale",
      "is_tax_inclusive": true,
      "price_id": "price#1",
      "pricing_model": "per_unit",
      "product_id": "prod-id#12324",
      "quantity": 5,
      "taxes": Array [
        Object {
          "amount": 63024,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        },
      ],
      "unit_amount": 78946,
      "unit_amount_decimal": "789.456224456678",
      "unit_amount_gross": 78946,
      "unit_amount_gross_decimal": "789.456224456678",
      "unit_amount_net": 66341,
      "unit_amount_net_decimal": "663.408591980402",
    },
    Object {
      "_price": Object {
        "_id": "price#3",
        "_title": "Winter Lease",
        "billing_duration_amount": 1,
        "billing_duration_unit": "years",
        "billing_period": "yearly",
        "description": "Winter Lease",
        "is_tax_inclusive": false,
        "notice_time_amount": 1,
        "notice_time_unit": "months",
        "pricing_model": "per_unit",
        "renewal_duration_amount": 1,
        "renewal_duration_unit": "years",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "6",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 6,
            "type": "VAT",
          },
        ],
        "termination_time_amount": 2,
        "termination_time_unit": "weeks",
        "type": "recurring",
        "unit_amount": 4546,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "45.456224456678",
      },
      "_product": Object {},
      "amount_subtotal": 13637,
      "amount_subtotal_decimal": "136.368673370034",
      "amount_tax": 818,
      "amount_total": 14455,
      "amount_total_decimal": "144.550793772237",
      "currency": "EUR",
      "description": "Winter Lease",
      "is_tax_inclusive": false,
      "price_id": "price#3",
      "pricing_model": "per_unit",
      "product_id": "prod-id#12324",
      "quantity": 3,
      "taxes": Array [
        Object {
          "amount": 818,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "6",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 6,
            "type": "VAT",
          },
        },
      ],
      "unit_amount": 4546,
      "unit_amount_decimal": "45.456224456678",
      "unit_amount_gross": 4818,
      "unit_amount_gross_decimal": "48.183597924079",
      "unit_amount_net": 4546,
      "unit_amount_net_decimal": "45.456224456678",
    },
    Object {
      "_price": Object {
        "_id": "price#4",
        "_tags": Array [
          "composite",
        ],
        "_title": "Eletricity Pack 1",
        "active": true,
        "description": "Eletricity Pack 1",
        "is_composite_price": true,
        "price_components": Array [
          Object {
            "_id": "price#4-comp#1",
            "_title": "Base price per month",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Base price per month",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "recurring",
            "unit_amount": 1069,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "10.69",
          },
          Object {
            "_id": "price#4-comp#2",
            "_title": "Energy price per kWh",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Energy price per kWh",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "6",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 6,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "recurring",
            "unit": "kwh",
            "unit_amount": 45,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "0.45",
            "variable_price": true,
          },
          Object {
            "_id": "price#4-comp#3",
            "_title": "Wallbox 11 kW",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "weekly",
            "description": "Wallbox 11 kW",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "sales_tax": "standard",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "19",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 19,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "one_time",
            "unit_amount": 50000,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "500.00",
          },
        ],
        "price_display_in_journeys": "show_price",
        "sales_tax": "standard",
        "type": "one_time",
        "unit_amount_currency": "EUR",
      },
      "_product": Object {},
      "amount_subtotal": 43031,
      "amount_subtotal_decimal": "430.31077734696",
      "amount_tax": 8083,
      "amount_total": 51114,
      "amount_total_decimal": "511.14",
      "currency": "EUR",
      "description": "Eletricity Pack 1",
      "item_components": Array [
        Object {
          "_price": Object {
            "_id": "price#4-comp#1",
            "_title": "Base price per month",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Base price per month",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "recurring",
            "unit_amount": 1069,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "10.69",
          },
          "_product": Object {},
          "amount_subtotal": 972,
          "amount_subtotal_decimal": "9.718181818182",
          "amount_tax": 97,
          "amount_total": 1069,
          "amount_total_decimal": "10.69",
          "billing_period": "monthly",
          "currency": "EUR",
          "description": "Base price per month",
          "is_tax_inclusive": true,
          "price_id": "price#4-comp#1",
          "pricing_model": "per_unit",
          "product_id": "prod-id#1234",
          "quantity": 1,
          "taxes": Array [
            Object {
              "amount": 97,
              "tax": Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            },
          ],
          "type": "recurring",
          "unit_amount": 1069,
          "unit_amount_decimal": "10.69",
          "unit_amount_gross": 1069,
          "unit_amount_gross_decimal": "10.69",
          "unit_amount_net": 972,
          "unit_amount_net_decimal": "9.718181818182",
        },
        Object {
          "_price": Object {
            "_id": "price#4-comp#2",
            "_title": "Energy price per kWh",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Energy price per kWh",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "6",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 6,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "recurring",
            "unit": "kwh",
            "unit_amount": 45,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "0.45",
            "variable_price": true,
          },
          "_product": Object {},
          "amount_subtotal": 42,
          "amount_subtotal_decimal": "0.424528301887",
          "amount_tax": 3,
          "amount_total": 45,
          "amount_total_decimal": "0.45",
          "billing_period": "monthly",
          "currency": "EUR",
          "description": "Energy price per kWh",
          "is_tax_inclusive": true,
          "price_id": "price#4-comp#2",
          "pricing_model": "per_unit",
          "product_id": "prod-id#1234",
          "quantity": 1,
          "taxes": Array [
            Object {
              "amount": 3,
              "tax": Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "6",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 6,
                "type": "VAT",
              },
            },
          ],
          "type": "recurring",
          "unit_amount": 45,
          "unit_amount_decimal": "0.45",
          "unit_amount_gross": 45,
          "unit_amount_gross_decimal": "0.45",
          "unit_amount_net": 42,
          "unit_amount_net_decimal": "0.424528301887",
        },
        Object {
          "_price": Object {
            "_id": "price#4-comp#3",
            "_title": "Wallbox 11 kW",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "weekly",
            "description": "Wallbox 11 kW",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "sales_tax": "standard",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "19",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 19,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "one_time",
            "unit_amount": 50000,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "500.00",
          },
          "_product": Object {},
          "amount_subtotal": 42017,
          "amount_subtotal_decimal": "420.168067226891",
          "amount_tax": 7983,
          "amount_total": 50000,
          "amount_total_decimal": "500",
          "currency": "EUR",
          "description": "Wallbox 11 kW",
          "is_tax_inclusive": true,
          "price_id": "price#4-comp#3",
          "pricing_model": "per_unit",
          "product_id": "prod-id#1234",
          "quantity": 1,
          "taxes": Array [
            Object {
              "amount": 7983,
              "tax": Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "19",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 19,
                "type": "VAT",
              },
            },
          ],
          "type": "one_time",
          "unit_amount": 50000,
          "unit_amount_decimal": "500.00",
          "unit_amount_gross": 50000,
          "unit_amount_gross_decimal": "500",
          "unit_amount_net": 42017,
          "unit_amount_net_decimal": "420.168067226891",
        },
      ],
      "price_id": "price#4",
      "product_id": "prod-id#1234",
      "quantity": 1,
      "total_details": Object {
        "amount_tax": 8083,
        "breakdown": Object {
          "recurrences": Array [
            Object {
              "amount_subtotal": 1014,
              "amount_subtotal_decimal": "10.142710120069",
              "amount_tax": 100,
              "amount_total": 1114,
              "amount_total_decimal": "11.14",
              "billing_period": "monthly",
              "type": "recurring",
              "unit_amount_gross": 1114,
              "unit_amount_net": 1014,
            },
            Object {
              "amount_subtotal": 42017,
              "amount_subtotal_decimal": "420.168067226891",
              "amount_tax": 7983,
              "amount_total": 50000,
              "amount_total_decimal": "500",
              "type": "one_time",
              "unit_amount_gross": 50000,
              "unit_amount_net": 42017,
            },
          ],
          "recurrencesByTax": Array [
            Object {
              "amount_subtotal": 972,
              "amount_tax": 97,
              "amount_total": 1069,
              "billing_period": "monthly",
              "tax": Object {
                "amount": 97,
                "tax": Object {
                  "_id": "10",
                  "rate": 10,
                  "type": "VAT",
                },
              },
              "type": "recurring",
            },
            Object {
              "amount_subtotal": 42,
              "amount_tax": 3,
              "amount_total": 45,
              "billing_period": "monthly",
              "tax": Object {
                "amount": 3,
                "tax": Object {
                  "_id": "6",
                  "rate": 6,
                  "type": "VAT",
                },
              },
              "type": "recurring",
            },
            Object {
              "amount_subtotal": 42017,
              "amount_tax": 7983,
              "amount_total": 50000,
              "tax": Object {
                "amount": 7983,
                "tax": Object {
                  "_id": "19",
                  "rate": 19,
                  "type": "VAT",
                },
              },
              "type": "one_time",
            },
          ],
          "taxes": Array [
            Object {
              "amount": 97,
              "tax": Object {
                "_id": "10",
                "rate": 10,
                "type": "VAT",
              },
            },
            Object {
              "amount": 3,
              "tax": Object {
                "_id": "6",
                "rate": 6,
                "type": "VAT",
              },
            },
            Object {
              "amount": 7983,
              "tax": Object {
                "_id": "19",
                "rate": 19,
                "type": "VAT",
              },
            },
          ],
        },
      },
    },
  ],
  "total_details": Object {
    "amount_tax": 136317,
    "breakdown": Object {
      "recurrences": Array [
        Object {
          "amount_subtotal": 705425,
          "amount_subtotal_decimal": "7054.253987030911",
          "amount_tax": 134031,
          "amount_total": 839456,
          "amount_total_decimal": "8394.56224456678",
          "type": "one_time",
          "unit_amount_gross": 207891,
          "unit_amount_net": 174699,
        },
        Object {
          "amount_subtotal": 3910,
          "amount_subtotal_decimal": "39.097520587866",
          "amount_tax": 650,
          "amount_total": 4560,
          "amount_total_decimal": "45.596224456678",
          "billing_period": "monthly",
          "type": "recurring",
          "unit_amount_gross": 4560,
          "unit_amount_net": 3910,
        },
        Object {
          "amount_subtotal": 27274,
          "amount_subtotal_decimal": "272.737346740068",
          "amount_tax": 1636,
          "amount_total": 28910,
          "amount_total_decimal": "289.101587544474",
          "billing_period": "yearly",
          "type": "recurring",
          "unit_amount_gross": 9637,
          "unit_amount_net": 9091,
        },
      ],
      "recurrencesByTax": Array [
        Object {
          "amount_subtotal": 705425,
          "amount_tax": 134031,
          "amount_total": 839456,
          "tax": Object {
            "amount": 134581,
            "tax": Object {
              "_id": "19",
              "rate": 19,
              "type": "VAT",
            },
          },
          "type": "one_time",
        },
        Object {
          "amount_subtotal": 2895,
          "amount_tax": 550,
          "amount_total": 3446,
          "billing_period": "monthly",
          "tax": Object {
            "amount": 134581,
            "tax": Object {
              "_id": "19",
              "rate": 19,
              "type": "VAT",
            },
          },
          "type": "recurring",
        },
        Object {
          "amount_subtotal": 27274,
          "amount_tax": 1636,
          "amount_total": 28910,
          "billing_period": "yearly",
          "tax": Object {
            "amount": 1639,
            "tax": Object {
              "_id": "6",
              "rate": 6,
              "type": "VAT",
            },
          },
          "type": "recurring",
        },
        Object {
          "amount_subtotal": 972,
          "amount_tax": 97,
          "amount_total": 1069,
          "billing_period": "monthly",
          "tax": Object {
            "amount": 97,
            "tax": Object {
              "_id": "10",
              "rate": 10,
              "type": "VAT",
            },
          },
          "type": "recurring",
        },
        Object {
          "amount_subtotal": 42,
          "amount_tax": 3,
          "amount_total": 45,
          "billing_period": "monthly",
          "tax": Object {
            "amount": 1639,
            "tax": Object {
              "_id": "6",
              "rate": 6,
              "type": "VAT",
            },
          },
          "type": "recurring",
        },
      ],
      "taxes": Array [
        Object {
          "amount": 134581,
          "tax": Object {
            "_id": "19",
            "rate": 19,
            "type": "VAT",
          },
        },
        Object {
          "amount": 1639,
          "tax": Object {
            "_id": "6",
            "rate": 6,
            "type": "VAT",
          },
        },
        Object {
          "amount": 97,
          "tax": Object {
            "_id": "10",
            "rate": 10,
            "type": "VAT",
          },
        },
      ],
    },
  },
}
`;

exports[`computeAggregatedAndPriceTotals when is_composite_price = false should return the right result when there is one item per recurrence 1`] = `
Object {
  "amount_subtotal": 361874,
  "amount_tax": 65756,
  "amount_total": 427629,
  "currency": "EUR",
  "items": Array [
    Object {
      "_price": Object {
        "_id": "price#1",
        "_title": "Winter Sale",
        "description": "Winter Sale",
        "is_tax_inclusive": true,
        "pricing_model": "per_unit",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        ],
        "type": "one_time",
        "unit_amount": 78946,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "789.456224456678",
      },
      "_product": Object {
        "_tags": Array [
          "product-tag-1",
          "product-tag-2",
        ],
      },
      "amount_subtotal": 331704,
      "amount_subtotal_decimal": "3317.04295990201",
      "amount_tax": 63024,
      "amount_total": 394728,
      "amount_total_decimal": "3947.28112228339",
      "currency": "EUR",
      "description": "Winter Sale",
      "is_tax_inclusive": true,
      "price_id": "price#1",
      "pricing_model": "per_unit",
      "product_id": "prod-id#12324",
      "quantity": 5,
      "taxes": Array [
        Object {
          "amount": 63024,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        },
      ],
      "unit_amount": 78946,
      "unit_amount_decimal": "789.456224456678",
      "unit_amount_gross": 78946,
      "unit_amount_gross_decimal": "789.456224456678",
      "unit_amount_net": 66341,
      "unit_amount_net_decimal": "663.408591980402",
    },
    Object {
      "_price": Object {
        "_id": "price#2",
        "_title": "Winter Lease",
        "billing_duration_amount": 1,
        "billing_duration_unit": "years",
        "billing_period": "monthly",
        "description": "Winter Lease",
        "is_tax_inclusive": true,
        "notice_time_amount": 1,
        "notice_time_unit": "months",
        "pricing_model": "per_unit",
        "renewal_duration_amount": 1,
        "renewal_duration_unit": "years",
        "sales_tax": "standard",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        ],
        "termination_time_amount": 2,
        "termination_time_unit": "weeks",
        "type": "recurring",
        "unit_amount": 3447,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "34.456224456678",
      },
      "_product": Object {},
      "amount_subtotal": 2895,
      "amount_subtotal_decimal": "28.954810467797",
      "amount_tax": 550,
      "amount_total": 3446,
      "amount_total_decimal": "34.456224456678",
      "currency": "EUR",
      "description": "Winter Lease",
      "is_tax_inclusive": true,
      "price_id": "price#2",
      "pricing_model": "per_unit",
      "product_id": "prod-id#12324",
      "quantity": 1,
      "taxes": Array [
        Object {
          "amount": 550,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        },
      ],
      "unit_amount": 3446,
      "unit_amount_decimal": "34.456224456678",
      "unit_amount_gross": 3446,
      "unit_amount_gross_decimal": "34.456224456678",
      "unit_amount_net": 2895,
      "unit_amount_net_decimal": "28.954810467797",
    },
    Object {
      "_price": Object {
        "_id": "price#3",
        "_tags": Array [
          "price-tag-1",
          "price-tag-2",
        ],
        "_title": "Winter Lease",
        "billing_duration_amount": 1,
        "billing_duration_unit": "years",
        "billing_period": "yearly",
        "description": "Winter Lease",
        "is_tax_inclusive": false,
        "notice_time_amount": 1,
        "notice_time_unit": "months",
        "pricing_model": "per_unit",
        "renewal_duration_amount": 1,
        "renewal_duration_unit": "years",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "6",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 6,
            "type": "VAT",
          },
        ],
        "termination_time_amount": 2,
        "termination_time_unit": "weeks",
        "type": "recurring",
        "unit_amount": 4546,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "45.456224456678",
      },
      "_product": Object {},
      "amount_subtotal": 13637,
      "amount_subtotal_decimal": "136.368673370034",
      "amount_tax": 818,
      "amount_total": 14455,
      "amount_total_decimal": "144.550793772237",
      "currency": "EUR",
      "description": "Winter Lease",
      "is_tax_inclusive": false,
      "price_id": "price#3",
      "pricing_model": "per_unit",
      "product_id": "prod-id#12324",
      "quantity": 3,
      "taxes": Array [
        Object {
          "amount": 818,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "6",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 6,
            "type": "VAT",
          },
        },
      ],
      "unit_amount": 4546,
      "unit_amount_decimal": "45.456224456678",
      "unit_amount_gross": 4818,
      "unit_amount_gross_decimal": "48.183597924079",
      "unit_amount_net": 4546,
      "unit_amount_net_decimal": "45.456224456678",
    },
    Object {
      "_price": Object {
        "_id": "price#6",
        "_title": "Winter Lease",
        "billing_duration_amount": 1,
        "billing_duration_unit": "years",
        "billing_period": "yearly",
        "description": "Winter Lease",
        "is_tax_inclusive": false,
        "notice_time_amount": 1,
        "notice_time_unit": "months",
        "pricing_model": "per_unit",
        "renewal_duration_amount": 1,
        "renewal_duration_unit": "years",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "10",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 10,
            "type": "VAT",
          },
        ],
        "termination_time_amount": 2,
        "termination_time_unit": "weeks",
        "type": "recurring",
        "unit_amount": 4546,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "45.456224456678",
      },
      "amount_subtotal": 13637,
      "amount_subtotal_decimal": "136.368673370034",
      "amount_tax": 1364,
      "amount_total": 15001,
      "amount_total_decimal": "150.005540707038",
      "currency": "EUR",
      "description": "Winter Lease",
      "is_tax_inclusive": false,
      "price_id": "price#6",
      "pricing_model": "tiered_volume",
      "product_id": "prod-id#12324",
      "quantity": 3,
      "taxes": Array [
        Object {
          "amount": 1364,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "10",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 10,
            "type": "VAT",
          },
        },
      ],
      "unit_amount": 4546,
      "unit_amount_decimal": "45.456224456678",
      "unit_amount_gross": 5000,
      "unit_amount_gross_decimal": "50.001846902346",
      "unit_amount_net": 4546,
      "unit_amount_net_decimal": "45.456224456678",
    },
  ],
  "total_details": Object {
    "amount_tax": 65756,
    "breakdown": Object {
      "recurrences": Array [
        Object {
          "amount_subtotal": 331704,
          "amount_subtotal_decimal": "3317.04295990201",
          "amount_tax": 63024,
          "amount_total": 394728,
          "amount_total_decimal": "3947.28112228339",
          "type": "one_time",
          "unit_amount_gross": 78946,
          "unit_amount_net": 66341,
        },
        Object {
          "amount_subtotal": 2895,
          "amount_subtotal_decimal": "28.954810467797",
          "amount_tax": 550,
          "amount_total": 3446,
          "amount_total_decimal": "34.456224456678",
          "billing_period": "monthly",
          "type": "recurring",
          "unit_amount_gross": 3446,
          "unit_amount_net": 2895,
        },
        Object {
          "amount_subtotal": 27274,
          "amount_subtotal_decimal": "272.737346740068",
          "amount_tax": 2182,
          "amount_total": 29456,
          "amount_total_decimal": "294.556334479275",
          "billing_period": "yearly",
          "type": "recurring",
          "unit_amount_gross": 9819,
          "unit_amount_net": 9091,
        },
      ],
      "recurrencesByTax": Array [
        Object {
          "amount_subtotal": 331704,
          "amount_tax": 63024,
          "amount_total": 394728,
          "tax": Object {
            "amount": 63574,
            "tax": Object {
              "_id": "19",
              "rate": 19,
              "type": "VAT",
            },
          },
          "type": "one_time",
        },
        Object {
          "amount_subtotal": 2895,
          "amount_tax": 550,
          "amount_total": 3446,
          "billing_period": "monthly",
          "tax": Object {
            "amount": 63574,
            "tax": Object {
              "_id": "19",
              "rate": 19,
              "type": "VAT",
            },
          },
          "type": "recurring",
        },
        Object {
          "amount_subtotal": 13637,
          "amount_tax": 818,
          "amount_total": 14455,
          "billing_period": "yearly",
          "tax": Object {
            "amount": 818,
            "tax": Object {
              "_id": "6",
              "rate": 6,
              "type": "VAT",
            },
          },
          "type": "recurring",
        },
        Object {
          "amount_subtotal": 13637,
          "amount_tax": 1364,
          "amount_total": 15001,
          "billing_period": "yearly",
          "tax": Object {
            "amount": 1364,
            "tax": Object {
              "_id": "10",
              "rate": 10,
              "type": "VAT",
            },
          },
          "type": "recurring",
        },
      ],
      "taxes": Array [
        Object {
          "amount": 63574,
          "tax": Object {
            "_id": "19",
            "rate": 19,
            "type": "VAT",
          },
        },
        Object {
          "amount": 818,
          "tax": Object {
            "_id": "6",
            "rate": 6,
            "type": "VAT",
          },
        },
        Object {
          "amount": 1364,
          "tax": Object {
            "_id": "10",
            "rate": 10,
            "type": "VAT",
          },
        },
      ],
    },
  },
}
`;

exports[`computeAggregatedAndPriceTotals when is_composite_price = false should return the right result when there is one simple price with display mode "On Request" and other simple prices 1`] = `
Object {
  "amount_subtotal": 361874,
  "amount_tax": 65756,
  "amount_total": 427629,
  "currency": "EUR",
  "items": Array [
    Object {
      "_price": Object {
        "_id": "price#1",
        "_title": "Winter Sale",
        "description": "Winter Sale",
        "is_tax_inclusive": true,
        "pricing_model": "per_unit",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        ],
        "type": "one_time",
        "unit_amount": 78946,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "789.456224456678",
      },
      "_product": Object {
        "_tags": Array [
          "product-tag-1",
          "product-tag-2",
        ],
      },
      "amount_subtotal": 331704,
      "amount_subtotal_decimal": "3317.04295990201",
      "amount_tax": 63024,
      "amount_total": 394728,
      "amount_total_decimal": "3947.28112228339",
      "currency": "EUR",
      "description": "Winter Sale",
      "is_tax_inclusive": true,
      "price_id": "price#1",
      "pricing_model": "per_unit",
      "product_id": "prod-id#12324",
      "quantity": 5,
      "taxes": Array [
        Object {
          "amount": 63024,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        },
      ],
      "unit_amount": 78946,
      "unit_amount_decimal": "789.456224456678",
      "unit_amount_gross": 78946,
      "unit_amount_gross_decimal": "789.456224456678",
      "unit_amount_net": 66341,
      "unit_amount_net_decimal": "663.408591980402",
    },
    Object {
      "_price": Object {
        "_id": "price#2",
        "_title": "Winter Lease",
        "billing_duration_amount": 1,
        "billing_duration_unit": "years",
        "billing_period": "monthly",
        "description": "Winter Lease",
        "is_tax_inclusive": true,
        "notice_time_amount": 1,
        "notice_time_unit": "months",
        "pricing_model": "per_unit",
        "renewal_duration_amount": 1,
        "renewal_duration_unit": "years",
        "sales_tax": "standard",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        ],
        "termination_time_amount": 2,
        "termination_time_unit": "weeks",
        "type": "recurring",
        "unit_amount": 3447,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "34.456224456678",
      },
      "_product": Object {},
      "amount_subtotal": 2895,
      "amount_subtotal_decimal": "28.954810467797",
      "amount_tax": 550,
      "amount_total": 3446,
      "amount_total_decimal": "34.456224456678",
      "currency": "EUR",
      "description": "Winter Lease",
      "is_tax_inclusive": true,
      "price_id": "price#2",
      "pricing_model": "per_unit",
      "product_id": "prod-id#12324",
      "quantity": 1,
      "taxes": Array [
        Object {
          "amount": 550,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        },
      ],
      "unit_amount": 3446,
      "unit_amount_decimal": "34.456224456678",
      "unit_amount_gross": 3446,
      "unit_amount_gross_decimal": "34.456224456678",
      "unit_amount_net": 2895,
      "unit_amount_net_decimal": "28.954810467797",
    },
    Object {
      "_price": Object {
        "_id": "price#3",
        "_tags": Array [
          "price-tag-1",
          "price-tag-2",
        ],
        "_title": "Winter Lease",
        "billing_duration_amount": 1,
        "billing_duration_unit": "years",
        "billing_period": "yearly",
        "description": "Winter Lease",
        "is_tax_inclusive": false,
        "notice_time_amount": 1,
        "notice_time_unit": "months",
        "pricing_model": "per_unit",
        "renewal_duration_amount": 1,
        "renewal_duration_unit": "years",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "6",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 6,
            "type": "VAT",
          },
        ],
        "termination_time_amount": 2,
        "termination_time_unit": "weeks",
        "type": "recurring",
        "unit_amount": 4546,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "45.456224456678",
      },
      "_product": Object {},
      "amount_subtotal": 13637,
      "amount_subtotal_decimal": "136.368673370034",
      "amount_tax": 818,
      "amount_total": 14455,
      "amount_total_decimal": "144.550793772237",
      "currency": "EUR",
      "description": "Winter Lease",
      "is_tax_inclusive": false,
      "price_id": "price#3",
      "pricing_model": "per_unit",
      "product_id": "prod-id#12324",
      "quantity": 3,
      "taxes": Array [
        Object {
          "amount": 818,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "6",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 6,
            "type": "VAT",
          },
        },
      ],
      "unit_amount": 4546,
      "unit_amount_decimal": "45.456224456678",
      "unit_amount_gross": 4818,
      "unit_amount_gross_decimal": "48.183597924079",
      "unit_amount_net": 4546,
      "unit_amount_net_decimal": "45.456224456678",
    },
    Object {
      "_price": Object {
        "_id": "price#6",
        "_title": "Winter Lease",
        "billing_duration_amount": 1,
        "billing_duration_unit": "years",
        "billing_period": "yearly",
        "description": "Winter Lease",
        "is_tax_inclusive": false,
        "notice_time_amount": 1,
        "notice_time_unit": "months",
        "pricing_model": "per_unit",
        "renewal_duration_amount": 1,
        "renewal_duration_unit": "years",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "10",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 10,
            "type": "VAT",
          },
        ],
        "termination_time_amount": 2,
        "termination_time_unit": "weeks",
        "type": "recurring",
        "unit_amount": 4546,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "45.456224456678",
      },
      "amount_subtotal": 13637,
      "amount_subtotal_decimal": "136.368673370034",
      "amount_tax": 1364,
      "amount_total": 15001,
      "amount_total_decimal": "150.005540707038",
      "currency": "EUR",
      "description": "Winter Lease",
      "is_tax_inclusive": false,
      "price_id": "price#6",
      "pricing_model": "tiered_volume",
      "product_id": "prod-id#12324",
      "quantity": 3,
      "taxes": Array [
        Object {
          "amount": 1364,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "10",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 10,
            "type": "VAT",
          },
        },
      ],
      "unit_amount": 4546,
      "unit_amount_decimal": "45.456224456678",
      "unit_amount_gross": 5000,
      "unit_amount_gross_decimal": "50.001846902346",
      "unit_amount_net": 4546,
      "unit_amount_net_decimal": "45.456224456678",
    },
    Object {
      "_price": Object {
        "_id": "price#7",
        "_title": "Winter Lease",
        "billing_duration_amount": 1,
        "billing_duration_unit": "years",
        "billing_period": "yearly",
        "description": "Winter Lease",
        "is_tax_inclusive": false,
        "notice_time_amount": 1,
        "notice_time_unit": "months",
        "price_display_in_journeys": "show_as_on_request",
        "pricing_model": "per_unit",
        "renewal_duration_amount": 1,
        "renewal_duration_unit": "years",
        "termination_time_amount": 2,
        "termination_time_unit": "weeks",
        "type": "recurring",
        "unit_amount": 4546,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "45.456224456678",
      },
      "amount_subtotal": 4546,
      "amount_subtotal_decimal": "45.456224456678",
      "amount_tax": 455,
      "amount_total": 5000,
      "amount_total_decimal": "50.001846902346",
      "currency": "EUR",
      "description": "Winter Lease",
      "is_tax_inclusive": false,
      "price_id": "price#7",
      "pricing_model": "per_unit",
      "product_id": "prod-id#12325",
      "quantity": 1,
      "taxes": Array [
        Object {
          "amount": 455,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "10",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 10,
            "type": "VAT",
          },
        },
      ],
      "unit_amount": 4546,
      "unit_amount_decimal": "45.456224456678",
      "unit_amount_gross": 5000,
      "unit_amount_gross_decimal": "50.001846902346",
      "unit_amount_net": 4546,
      "unit_amount_net_decimal": "45.456224456678",
    },
  ],
  "total_details": Object {
    "amount_tax": 65756,
    "breakdown": Object {
      "recurrences": Array [
        Object {
          "amount_subtotal": 331704,
          "amount_subtotal_decimal": "3317.04295990201",
          "amount_tax": 63024,
          "amount_total": 394728,
          "amount_total_decimal": "3947.28112228339",
          "type": "one_time",
          "unit_amount_gross": 78946,
          "unit_amount_net": 66341,
        },
        Object {
          "amount_subtotal": 2895,
          "amount_subtotal_decimal": "28.954810467797",
          "amount_tax": 550,
          "amount_total": 3446,
          "amount_total_decimal": "34.456224456678",
          "billing_period": "monthly",
          "type": "recurring",
          "unit_amount_gross": 3446,
          "unit_amount_net": 2895,
        },
        Object {
          "amount_subtotal": 27274,
          "amount_subtotal_decimal": "272.737346740068",
          "amount_tax": 2182,
          "amount_total": 29456,
          "amount_total_decimal": "294.556334479275",
          "billing_period": "yearly",
          "type": "recurring",
          "unit_amount_gross": 9819,
          "unit_amount_net": 9091,
        },
      ],
      "recurrencesByTax": Array [
        Object {
          "amount_subtotal": 331704,
          "amount_tax": 63024,
          "amount_total": 394728,
          "tax": Object {
            "amount": 63574,
            "tax": Object {
              "_id": "19",
              "rate": 19,
              "type": "VAT",
            },
          },
          "type": "one_time",
        },
        Object {
          "amount_subtotal": 2895,
          "amount_tax": 550,
          "amount_total": 3446,
          "billing_period": "monthly",
          "tax": Object {
            "amount": 63574,
            "tax": Object {
              "_id": "19",
              "rate": 19,
              "type": "VAT",
            },
          },
          "type": "recurring",
        },
        Object {
          "amount_subtotal": 13637,
          "amount_tax": 818,
          "amount_total": 14455,
          "billing_period": "yearly",
          "tax": Object {
            "amount": 818,
            "tax": Object {
              "_id": "6",
              "rate": 6,
              "type": "VAT",
            },
          },
          "type": "recurring",
        },
        Object {
          "amount_subtotal": 13637,
          "amount_tax": 1364,
          "amount_total": 15001,
          "billing_period": "yearly",
          "tax": Object {
            "amount": 1364,
            "tax": Object {
              "_id": "10",
              "rate": 10,
              "type": "VAT",
            },
          },
          "type": "recurring",
        },
      ],
      "taxes": Array [
        Object {
          "amount": 63574,
          "tax": Object {
            "_id": "19",
            "rate": 19,
            "type": "VAT",
          },
        },
        Object {
          "amount": 818,
          "tax": Object {
            "_id": "6",
            "rate": 6,
            "type": "VAT",
          },
        },
        Object {
          "amount": 1364,
          "tax": Object {
            "_id": "10",
            "rate": 10,
            "type": "VAT",
          },
        },
      ],
    },
  },
}
`;

exports[`computeAggregatedAndPriceTotals when is_composite_price = true should return the right result when there is one composite price with display mode "On Request" 1`] = `
Object {
  "amount_subtotal": 0,
  "amount_tax": 0,
  "amount_total": 0,
  "currency": "EUR",
  "items": Array [
    Object {
      "_price": Object {
        "_id": "price#4",
        "_tags": Array [
          "composite",
        ],
        "_title": "Eletricity Pack 1",
        "active": true,
        "description": "Eletricity Pack 1",
        "is_composite_price": true,
        "price_components": Array [
          Object {
            "_id": "price#4-comp#1",
            "_title": "Base price per month",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Base price per month",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_as_on_request",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "recurring",
            "unit_amount": 1069,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "10.69",
          },
          Object {
            "_id": "price#4-comp#2",
            "_title": "Base price per month",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Base price per month",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "recurring",
            "unit_amount": 1069,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "10.69",
          },
        ],
        "price_display_in_journeys": "show_price",
        "pricing_model": "per_unit",
        "sales_tax": "standard",
        "type": "one_time",
        "unit_amount_currency": "EUR",
      },
      "_product": Object {},
      "amount_subtotal": 0,
      "amount_subtotal_decimal": "0",
      "amount_tax": 0,
      "amount_total": 0,
      "amount_total_decimal": "0",
      "currency": "EUR",
      "description": "Eletricity Pack 1",
      "item_components": Array [
        Object {
          "_price": Object {
            "_id": "price#4-comp#1",
            "_title": "Base price per month",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Base price per month",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_as_on_request",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "recurring",
            "unit_amount": 1069,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "10.69",
          },
          "_product": Object {},
          "amount_subtotal": 972,
          "amount_subtotal_decimal": "9.718181818182",
          "amount_tax": 97,
          "amount_total": 1069,
          "amount_total_decimal": "10.69",
          "billing_period": "monthly",
          "currency": "EUR",
          "description": "Base price per month",
          "is_tax_inclusive": true,
          "price_id": "price#4-comp#1",
          "pricing_model": "per_unit",
          "product_id": "prod-id#1234",
          "quantity": 1,
          "taxes": Array [
            Object {
              "amount": 97,
              "tax": Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            },
          ],
          "type": "recurring",
          "unit_amount": 1069,
          "unit_amount_decimal": "10.69",
          "unit_amount_gross": 1069,
          "unit_amount_gross_decimal": "10.69",
          "unit_amount_net": 972,
          "unit_amount_net_decimal": "9.718181818182",
        },
        Object {
          "_price": Object {
            "_id": "price#4-comp#2",
            "_title": "Base price per month",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Base price per month",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "recurring",
            "unit_amount": 1069,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "10.69",
          },
          "_product": Object {},
          "amount_subtotal": 972,
          "amount_subtotal_decimal": "9.718181818182",
          "amount_tax": 97,
          "amount_total": 1069,
          "amount_total_decimal": "10.69",
          "billing_period": "monthly",
          "currency": "EUR",
          "description": "Base price per month",
          "is_tax_inclusive": true,
          "price_id": "price#4-comp#2",
          "pricing_model": "per_unit",
          "product_id": "prod-id#1234",
          "quantity": 1,
          "taxes": Array [
            Object {
              "amount": 97,
              "tax": Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            },
          ],
          "type": "recurring",
          "unit_amount": 1069,
          "unit_amount_decimal": "10.69",
          "unit_amount_gross": 1069,
          "unit_amount_gross_decimal": "10.69",
          "unit_amount_net": 972,
          "unit_amount_net_decimal": "9.718181818182",
        },
      ],
      "price_id": "price#4",
      "product_id": "prod-id#1234",
      "quantity": 1,
      "total_details": Object {
        "amount_shipping": 0,
        "amount_tax": 0,
        "breakdown": Object {
          "recurrences": Array [],
          "recurrencesByTax": Array [],
          "taxes": Array [],
        },
      },
    },
  ],
  "total_details": Object {
    "amount_shipping": 0,
    "amount_tax": 0,
    "breakdown": Object {
      "recurrences": Array [],
      "recurrencesByTax": Array [],
      "taxes": Array [],
    },
  },
}
`;

exports[`computeAggregatedAndPriceTotals when is_composite_price = true should return the right result when there is one composite price with display mode "On Request" 2`] = `
Object {
  "amount_subtotal": 736609,
  "amount_tax": 136317,
  "amount_total": 872926,
  "currency": "EUR",
  "items": Array [
    Object {
      "_price": Object {
        "_id": "price#1",
        "_title": "Winter Sale",
        "description": "Winter Sale",
        "is_tax_inclusive": true,
        "pricing_model": "per_unit",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        ],
        "type": "one_time",
        "unit_amount": 78946,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "789.456224456678",
      },
      "_product": Object {
        "_tags": Array [
          "product-tag-1",
          "product-tag-2",
        ],
      },
      "amount_subtotal": 331704,
      "amount_subtotal_decimal": "3317.04295990201",
      "amount_tax": 63024,
      "amount_total": 394728,
      "amount_total_decimal": "3947.28112228339",
      "currency": "EUR",
      "description": "Winter Sale",
      "is_tax_inclusive": true,
      "price_id": "price#1",
      "pricing_model": "per_unit",
      "product_id": "prod-id#12324",
      "quantity": 5,
      "taxes": Array [
        Object {
          "amount": 63024,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        },
      ],
      "unit_amount": 78946,
      "unit_amount_decimal": "789.456224456678",
      "unit_amount_gross": 78946,
      "unit_amount_gross_decimal": "789.456224456678",
      "unit_amount_net": 66341,
      "unit_amount_net_decimal": "663.408591980402",
    },
    Object {
      "_price": Object {
        "_id": "price#2",
        "_title": "Winter Lease",
        "billing_duration_amount": 1,
        "billing_duration_unit": "years",
        "billing_period": "monthly",
        "description": "Winter Lease",
        "is_tax_inclusive": true,
        "notice_time_amount": 1,
        "notice_time_unit": "months",
        "pricing_model": "per_unit",
        "renewal_duration_amount": 1,
        "renewal_duration_unit": "years",
        "sales_tax": "standard",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        ],
        "termination_time_amount": 2,
        "termination_time_unit": "weeks",
        "type": "recurring",
        "unit_amount": 3447,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "34.456224456678",
      },
      "_product": Object {},
      "amount_subtotal": 2895,
      "amount_subtotal_decimal": "28.954810467797",
      "amount_tax": 550,
      "amount_total": 3446,
      "amount_total_decimal": "34.456224456678",
      "currency": "EUR",
      "description": "Winter Lease",
      "is_tax_inclusive": true,
      "price_id": "price#2",
      "pricing_model": "per_unit",
      "product_id": "prod-id#12324",
      "quantity": 1,
      "taxes": Array [
        Object {
          "amount": 550,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        },
      ],
      "unit_amount": 3446,
      "unit_amount_decimal": "34.456224456678",
      "unit_amount_gross": 3446,
      "unit_amount_gross_decimal": "34.456224456678",
      "unit_amount_net": 2895,
      "unit_amount_net_decimal": "28.954810467797",
    },
    Object {
      "_price": Object {
        "_id": "price#3",
        "_tags": Array [
          "price-tag-1",
          "price-tag-2",
        ],
        "_title": "Winter Lease",
        "billing_duration_amount": 1,
        "billing_duration_unit": "years",
        "billing_period": "yearly",
        "description": "Winter Lease",
        "is_tax_inclusive": false,
        "notice_time_amount": 1,
        "notice_time_unit": "months",
        "pricing_model": "per_unit",
        "renewal_duration_amount": 1,
        "renewal_duration_unit": "years",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "6",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 6,
            "type": "VAT",
          },
        ],
        "termination_time_amount": 2,
        "termination_time_unit": "weeks",
        "type": "recurring",
        "unit_amount": 4546,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "45.456224456678",
      },
      "_product": Object {},
      "amount_subtotal": 13637,
      "amount_subtotal_decimal": "136.368673370034",
      "amount_tax": 818,
      "amount_total": 14455,
      "amount_total_decimal": "144.550793772237",
      "currency": "EUR",
      "description": "Winter Lease",
      "is_tax_inclusive": false,
      "price_id": "price#3",
      "pricing_model": "per_unit",
      "product_id": "prod-id#12324",
      "quantity": 3,
      "taxes": Array [
        Object {
          "amount": 818,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "6",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 6,
            "type": "VAT",
          },
        },
      ],
      "unit_amount": 4546,
      "unit_amount_decimal": "45.456224456678",
      "unit_amount_gross": 4818,
      "unit_amount_gross_decimal": "48.183597924079",
      "unit_amount_net": 4546,
      "unit_amount_net_decimal": "45.456224456678",
    },
    Object {
      "_price": Object {
        "_id": "price#1",
        "_title": "Winter Sale",
        "description": "Winter Sale",
        "is_tax_inclusive": true,
        "pricing_model": "per_unit",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        ],
        "type": "one_time",
        "unit_amount": 78946,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "789.456224456678",
      },
      "_product": Object {},
      "amount_subtotal": 331704,
      "amount_subtotal_decimal": "3317.04295990201",
      "amount_tax": 63024,
      "amount_total": 394728,
      "amount_total_decimal": "3947.28112228339",
      "currency": "EUR",
      "description": "Winter Sale",
      "is_tax_inclusive": true,
      "price_id": "price#1",
      "pricing_model": "per_unit",
      "product_id": "prod-id#12324",
      "quantity": 5,
      "taxes": Array [
        Object {
          "amount": 63024,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        },
      ],
      "unit_amount": 78946,
      "unit_amount_decimal": "789.456224456678",
      "unit_amount_gross": 78946,
      "unit_amount_gross_decimal": "789.456224456678",
      "unit_amount_net": 66341,
      "unit_amount_net_decimal": "663.408591980402",
    },
    Object {
      "_price": Object {
        "_id": "price#3",
        "_title": "Winter Lease",
        "billing_duration_amount": 1,
        "billing_duration_unit": "years",
        "billing_period": "yearly",
        "description": "Winter Lease",
        "is_tax_inclusive": false,
        "notice_time_amount": 1,
        "notice_time_unit": "months",
        "pricing_model": "per_unit",
        "renewal_duration_amount": 1,
        "renewal_duration_unit": "years",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "6",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 6,
            "type": "VAT",
          },
        ],
        "termination_time_amount": 2,
        "termination_time_unit": "weeks",
        "type": "recurring",
        "unit_amount": 4546,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "45.456224456678",
      },
      "_product": Object {},
      "amount_subtotal": 13637,
      "amount_subtotal_decimal": "136.368673370034",
      "amount_tax": 818,
      "amount_total": 14455,
      "amount_total_decimal": "144.550793772237",
      "currency": "EUR",
      "description": "Winter Lease",
      "is_tax_inclusive": false,
      "price_id": "price#3",
      "pricing_model": "per_unit",
      "product_id": "prod-id#12324",
      "quantity": 3,
      "taxes": Array [
        Object {
          "amount": 818,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "6",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 6,
            "type": "VAT",
          },
        },
      ],
      "unit_amount": 4546,
      "unit_amount_decimal": "45.456224456678",
      "unit_amount_gross": 4818,
      "unit_amount_gross_decimal": "48.183597924079",
      "unit_amount_net": 4546,
      "unit_amount_net_decimal": "45.456224456678",
    },
    Object {
      "_price": Object {
        "_id": "price#4",
        "_tags": Array [
          "composite",
        ],
        "_title": "Eletricity Pack 1",
        "active": true,
        "description": "Eletricity Pack 1",
        "is_composite_price": true,
        "price_components": Array [
          Object {
            "_id": "price#4-comp#1",
            "_title": "Base price per month",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Base price per month",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "recurring",
            "unit_amount": 1069,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "10.69",
          },
          Object {
            "_id": "price#4-comp#2",
            "_title": "Energy price per kWh",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Energy price per kWh",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "6",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 6,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "recurring",
            "unit": "kwh",
            "unit_amount": 45,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "0.45",
            "variable_price": true,
          },
          Object {
            "_id": "price#4-comp#3",
            "_title": "Wallbox 11 kW",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "weekly",
            "description": "Wallbox 11 kW",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "sales_tax": "standard",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "19",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 19,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "one_time",
            "unit_amount": 50000,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "500.00",
          },
        ],
        "price_display_in_journeys": "show_price",
        "sales_tax": "standard",
        "type": "one_time",
        "unit_amount_currency": "EUR",
      },
      "_product": Object {},
      "amount_subtotal": 43031,
      "amount_subtotal_decimal": "430.31077734696",
      "amount_tax": 8083,
      "amount_total": 51114,
      "amount_total_decimal": "511.14",
      "currency": "EUR",
      "description": "Eletricity Pack 1",
      "item_components": Array [
        Object {
          "_price": Object {
            "_id": "price#4-comp#1",
            "_title": "Base price per month",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Base price per month",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "recurring",
            "unit_amount": 1069,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "10.69",
          },
          "_product": Object {},
          "amount_subtotal": 972,
          "amount_subtotal_decimal": "9.718181818182",
          "amount_tax": 97,
          "amount_total": 1069,
          "amount_total_decimal": "10.69",
          "billing_period": "monthly",
          "currency": "EUR",
          "description": "Base price per month",
          "is_tax_inclusive": true,
          "price_id": "price#4-comp#1",
          "pricing_model": "per_unit",
          "product_id": "prod-id#1234",
          "quantity": 1,
          "taxes": Array [
            Object {
              "amount": 97,
              "tax": Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            },
          ],
          "type": "recurring",
          "unit_amount": 1069,
          "unit_amount_decimal": "10.69",
          "unit_amount_gross": 1069,
          "unit_amount_gross_decimal": "10.69",
          "unit_amount_net": 972,
          "unit_amount_net_decimal": "9.718181818182",
        },
        Object {
          "_price": Object {
            "_id": "price#4-comp#2",
            "_title": "Energy price per kWh",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Energy price per kWh",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "6",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 6,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "recurring",
            "unit": "kwh",
            "unit_amount": 45,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "0.45",
            "variable_price": true,
          },
          "_product": Object {},
          "amount_subtotal": 42,
          "amount_subtotal_decimal": "0.424528301887",
          "amount_tax": 3,
          "amount_total": 45,
          "amount_total_decimal": "0.45",
          "billing_period": "monthly",
          "currency": "EUR",
          "description": "Energy price per kWh",
          "is_tax_inclusive": true,
          "price_id": "price#4-comp#2",
          "pricing_model": "per_unit",
          "product_id": "prod-id#1234",
          "quantity": 1,
          "taxes": Array [
            Object {
              "amount": 3,
              "tax": Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "6",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 6,
                "type": "VAT",
              },
            },
          ],
          "type": "recurring",
          "unit_amount": 45,
          "unit_amount_decimal": "0.45",
          "unit_amount_gross": 45,
          "unit_amount_gross_decimal": "0.45",
          "unit_amount_net": 42,
          "unit_amount_net_decimal": "0.424528301887",
        },
        Object {
          "_price": Object {
            "_id": "price#4-comp#3",
            "_title": "Wallbox 11 kW",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "weekly",
            "description": "Wallbox 11 kW",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "sales_tax": "standard",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "19",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 19,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "one_time",
            "unit_amount": 50000,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "500.00",
          },
          "_product": Object {},
          "amount_subtotal": 42017,
          "amount_subtotal_decimal": "420.168067226891",
          "amount_tax": 7983,
          "amount_total": 50000,
          "amount_total_decimal": "500",
          "currency": "EUR",
          "description": "Wallbox 11 kW",
          "is_tax_inclusive": true,
          "price_id": "price#4-comp#3",
          "pricing_model": "per_unit",
          "product_id": "prod-id#1234",
          "quantity": 1,
          "taxes": Array [
            Object {
              "amount": 7983,
              "tax": Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "19",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 19,
                "type": "VAT",
              },
            },
          ],
          "type": "one_time",
          "unit_amount": 50000,
          "unit_amount_decimal": "500.00",
          "unit_amount_gross": 50000,
          "unit_amount_gross_decimal": "500",
          "unit_amount_net": 42017,
          "unit_amount_net_decimal": "420.168067226891",
        },
      ],
      "price_id": "price#4",
      "product_id": "prod-id#1234",
      "quantity": 1,
      "total_details": Object {
        "amount_tax": 8083,
        "breakdown": Object {
          "recurrences": Array [
            Object {
              "amount_subtotal": 1014,
              "amount_subtotal_decimal": "10.142710120069",
              "amount_tax": 100,
              "amount_total": 1114,
              "amount_total_decimal": "11.14",
              "billing_period": "monthly",
              "type": "recurring",
              "unit_amount_gross": 1114,
              "unit_amount_net": 1014,
            },
            Object {
              "amount_subtotal": 42017,
              "amount_subtotal_decimal": "420.168067226891",
              "amount_tax": 7983,
              "amount_total": 50000,
              "amount_total_decimal": "500",
              "type": "one_time",
              "unit_amount_gross": 50000,
              "unit_amount_net": 42017,
            },
          ],
          "recurrencesByTax": Array [
            Object {
              "amount_subtotal": 972,
              "amount_tax": 97,
              "amount_total": 1069,
              "billing_period": "monthly",
              "tax": Object {
                "amount": 97,
                "tax": Object {
                  "_id": "10",
                  "rate": 10,
                  "type": "VAT",
                },
              },
              "type": "recurring",
            },
            Object {
              "amount_subtotal": 42,
              "amount_tax": 3,
              "amount_total": 45,
              "billing_period": "monthly",
              "tax": Object {
                "amount": 3,
                "tax": Object {
                  "_id": "6",
                  "rate": 6,
                  "type": "VAT",
                },
              },
              "type": "recurring",
            },
            Object {
              "amount_subtotal": 42017,
              "amount_tax": 7983,
              "amount_total": 50000,
              "tax": Object {
                "amount": 7983,
                "tax": Object {
                  "_id": "19",
                  "rate": 19,
                  "type": "VAT",
                },
              },
              "type": "one_time",
            },
          ],
          "taxes": Array [
            Object {
              "amount": 97,
              "tax": Object {
                "_id": "10",
                "rate": 10,
                "type": "VAT",
              },
            },
            Object {
              "amount": 3,
              "tax": Object {
                "_id": "6",
                "rate": 6,
                "type": "VAT",
              },
            },
            Object {
              "amount": 7983,
              "tax": Object {
                "_id": "19",
                "rate": 19,
                "type": "VAT",
              },
            },
          ],
        },
      },
    },
    Object {
      "_price": Object {
        "_id": "price#4",
        "_tags": Array [
          "composite",
        ],
        "_title": "Eletricity Pack 1",
        "active": true,
        "description": "Eletricity Pack 1",
        "is_composite_price": true,
        "price_components": Array [
          Object {
            "_id": "price#4-comp#1",
            "_title": "Base price per month",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Base price per month",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_as_on_request",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "recurring",
            "unit_amount": 1069,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "10.69",
          },
          Object {
            "_id": "price#4-comp#2",
            "_title": "Base price per month",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Base price per month",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "recurring",
            "unit_amount": 1069,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "10.69",
          },
        ],
        "price_display_in_journeys": "show_price",
        "pricing_model": "per_unit",
        "sales_tax": "standard",
        "type": "one_time",
        "unit_amount_currency": "EUR",
      },
      "_product": Object {},
      "amount_subtotal": 0,
      "amount_subtotal_decimal": "0",
      "amount_tax": 0,
      "amount_total": 0,
      "amount_total_decimal": "0",
      "currency": "EUR",
      "description": "Eletricity Pack 1",
      "item_components": Array [
        Object {
          "_price": Object {
            "_id": "price#4-comp#1",
            "_title": "Base price per month",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Base price per month",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_as_on_request",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "recurring",
            "unit_amount": 1069,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "10.69",
          },
          "_product": Object {},
          "amount_subtotal": 972,
          "amount_subtotal_decimal": "9.718181818182",
          "amount_tax": 97,
          "amount_total": 1069,
          "amount_total_decimal": "10.69",
          "billing_period": "monthly",
          "currency": "EUR",
          "description": "Base price per month",
          "is_tax_inclusive": true,
          "price_id": "price#4-comp#1",
          "pricing_model": "per_unit",
          "product_id": "prod-id#1234",
          "quantity": 1,
          "taxes": Array [
            Object {
              "amount": 97,
              "tax": Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            },
          ],
          "type": "recurring",
          "unit_amount": 1069,
          "unit_amount_decimal": "10.69",
          "unit_amount_gross": 1069,
          "unit_amount_gross_decimal": "10.69",
          "unit_amount_net": 972,
          "unit_amount_net_decimal": "9.718181818182",
        },
        Object {
          "_price": Object {
            "_id": "price#4-comp#2",
            "_title": "Base price per month",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Base price per month",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "recurring",
            "unit_amount": 1069,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "10.69",
          },
          "_product": Object {},
          "amount_subtotal": 972,
          "amount_subtotal_decimal": "9.718181818182",
          "amount_tax": 97,
          "amount_total": 1069,
          "amount_total_decimal": "10.69",
          "billing_period": "monthly",
          "currency": "EUR",
          "description": "Base price per month",
          "is_tax_inclusive": true,
          "price_id": "price#4-comp#2",
          "pricing_model": "per_unit",
          "product_id": "prod-id#1234",
          "quantity": 1,
          "taxes": Array [
            Object {
              "amount": 97,
              "tax": Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            },
          ],
          "type": "recurring",
          "unit_amount": 1069,
          "unit_amount_decimal": "10.69",
          "unit_amount_gross": 1069,
          "unit_amount_gross_decimal": "10.69",
          "unit_amount_net": 972,
          "unit_amount_net_decimal": "9.718181818182",
        },
      ],
      "price_id": "price#4",
      "product_id": "prod-id#1234",
      "quantity": 1,
      "total_details": Object {
        "amount_shipping": 0,
        "amount_tax": 0,
        "breakdown": Object {
          "recurrences": Array [],
          "recurrencesByTax": Array [],
          "taxes": Array [],
        },
      },
    },
  ],
  "total_details": Object {
    "amount_tax": 136317,
    "breakdown": Object {
      "recurrences": Array [
        Object {
          "amount_subtotal": 705425,
          "amount_subtotal_decimal": "7054.253987030911",
          "amount_tax": 134031,
          "amount_total": 839456,
          "amount_total_decimal": "8394.56224456678",
          "type": "one_time",
          "unit_amount_gross": 207891,
          "unit_amount_net": 174699,
        },
        Object {
          "amount_subtotal": 3910,
          "amount_subtotal_decimal": "39.097520587866",
          "amount_tax": 650,
          "amount_total": 4560,
          "amount_total_decimal": "45.596224456678",
          "billing_period": "monthly",
          "type": "recurring",
          "unit_amount_gross": 4560,
          "unit_amount_net": 3910,
        },
        Object {
          "amount_subtotal": 27274,
          "amount_subtotal_decimal": "272.737346740068",
          "amount_tax": 1636,
          "amount_total": 28910,
          "amount_total_decimal": "289.101587544474",
          "billing_period": "yearly",
          "type": "recurring",
          "unit_amount_gross": 9637,
          "unit_amount_net": 9091,
        },
      ],
      "recurrencesByTax": Array [
        Object {
          "amount_subtotal": 705425,
          "amount_tax": 134031,
          "amount_total": 839456,
          "tax": Object {
            "amount": 134581,
            "tax": Object {
              "_id": "19",
              "rate": 19,
              "type": "VAT",
            },
          },
          "type": "one_time",
        },
        Object {
          "amount_subtotal": 2895,
          "amount_tax": 550,
          "amount_total": 3446,
          "billing_period": "monthly",
          "tax": Object {
            "amount": 134581,
            "tax": Object {
              "_id": "19",
              "rate": 19,
              "type": "VAT",
            },
          },
          "type": "recurring",
        },
        Object {
          "amount_subtotal": 27274,
          "amount_tax": 1636,
          "amount_total": 28910,
          "billing_period": "yearly",
          "tax": Object {
            "amount": 1639,
            "tax": Object {
              "_id": "6",
              "rate": 6,
              "type": "VAT",
            },
          },
          "type": "recurring",
        },
        Object {
          "amount_subtotal": 972,
          "amount_tax": 97,
          "amount_total": 1069,
          "billing_period": "monthly",
          "tax": Object {
            "amount": 97,
            "tax": Object {
              "_id": "10",
              "rate": 10,
              "type": "VAT",
            },
          },
          "type": "recurring",
        },
        Object {
          "amount_subtotal": 42,
          "amount_tax": 3,
          "amount_total": 45,
          "billing_period": "monthly",
          "tax": Object {
            "amount": 1639,
            "tax": Object {
              "_id": "6",
              "rate": 6,
              "type": "VAT",
            },
          },
          "type": "recurring",
        },
      ],
      "taxes": Array [
        Object {
          "amount": 134581,
          "tax": Object {
            "_id": "19",
            "rate": 19,
            "type": "VAT",
          },
        },
        Object {
          "amount": 1639,
          "tax": Object {
            "_id": "6",
            "rate": 6,
            "type": "VAT",
          },
        },
        Object {
          "amount": 97,
          "tax": Object {
            "_id": "10",
            "rate": 10,
            "type": "VAT",
          },
        },
      ],
    },
  },
}
`;

exports[`computeAggregatedAndPriceTotals when is_composite_price = true should return the right result when there is one composite price with quantity 2 1`] = `
Object {
  "amount_subtotal": 86062,
  "amount_tax": 16166,
  "amount_total": 102228,
  "currency": "EUR",
  "items": Array [
    Object {
      "_price": Object {
        "_id": "price#4",
        "_tags": Array [
          "composite",
        ],
        "_title": "Eletricity Pack 1",
        "active": true,
        "description": "Eletricity Pack 1",
        "is_composite_price": true,
        "price_components": Array [
          Object {
            "_id": "price#4-comp#1",
            "_title": "Base price per month",
            "active": true,
            "billing_duration_amount": 18,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Base price per month",
            "is_tax_inclusive": true,
            "notice_time_amount": 16,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_amount": 18,
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            ],
            "termination_time_amount": 16,
            "termination_time_unit": "months",
            "type": "recurring",
            "unit_amount": 1069,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "10.69",
          },
          Object {
            "_id": "price#4-comp#2",
            "_title": "Energy price per kWh",
            "active": true,
            "billing_duration_amount": 18,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Energy price per kWh",
            "is_tax_inclusive": true,
            "notice_time_amount": 16,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_amount": 18,
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "6",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 6,
                "type": "VAT",
              },
            ],
            "termination_time_amount": 18,
            "termination_time_unit": "months",
            "type": "recurring",
            "unit": "kwh",
            "unit_amount": 45,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "0.45",
            "variable_price": true,
          },
          Object {
            "_id": "price#4-comp#3",
            "_title": "Wallbox 11 kW",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "weekly",
            "description": "Wallbox 11 kW",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "sales_tax": "standard",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "19",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 19,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "one_time",
            "unit_amount": 50000,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "500.00",
          },
          Object {
            "_id": "price#4-comp#6",
          },
        ],
        "price_display_in_journeys": "show_price",
        "pricing_model": "per_unit",
        "sales_tax": "standard",
        "type": "one_time",
        "unit_amount_currency": "EUR",
      },
      "_product": Object {},
      "amount_subtotal": 86062,
      "amount_subtotal_decimal": "860.62155469392",
      "amount_tax": 16166,
      "amount_total": 102228,
      "amount_total_decimal": "1022.28",
      "currency": "EUR",
      "description": "Eletricity Pack 1",
      "item_components": Array [
        Object {
          "_price": Object {
            "_id": "price#4-comp#1",
            "_title": "Base price per month",
            "active": true,
            "billing_duration_amount": 18,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Base price per month",
            "is_tax_inclusive": true,
            "notice_time_amount": 16,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_amount": 18,
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            ],
            "termination_time_amount": 16,
            "termination_time_unit": "months",
            "type": "recurring",
            "unit_amount": 1069,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "10.69",
          },
          "_product": Object {},
          "amount_subtotal": 1944,
          "amount_subtotal_decimal": "19.436363636364",
          "amount_tax": 194,
          "amount_total": 2138,
          "amount_total_decimal": "21.38",
          "billing_period": "monthly",
          "currency": "EUR",
          "description": "Base price per month",
          "is_tax_inclusive": true,
          "price_id": "price#4-comp#1",
          "pricing_model": "per_unit",
          "product_id": "prod-id#1234",
          "quantity": 1,
          "taxes": Array [
            Object {
              "amount": 194,
              "tax": Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            },
          ],
          "type": "recurring",
          "unit_amount": 1069,
          "unit_amount_decimal": "10.69",
          "unit_amount_gross": 1069,
          "unit_amount_gross_decimal": "10.69",
          "unit_amount_net": 972,
          "unit_amount_net_decimal": "9.718181818182",
        },
        Object {
          "_price": Object {
            "_id": "price#4-comp#2",
            "_title": "Energy price per kWh",
            "active": true,
            "billing_duration_amount": 18,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Energy price per kWh",
            "is_tax_inclusive": true,
            "notice_time_amount": 16,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_amount": 18,
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "6",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 6,
                "type": "VAT",
              },
            ],
            "termination_time_amount": 18,
            "termination_time_unit": "months",
            "type": "recurring",
            "unit": "kwh",
            "unit_amount": 45,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "0.45",
            "variable_price": true,
          },
          "_product": Object {},
          "amount_subtotal": 85,
          "amount_subtotal_decimal": "0.849056603774",
          "amount_tax": 5,
          "amount_total": 90,
          "amount_total_decimal": "0.9",
          "billing_period": "monthly",
          "currency": "EUR",
          "description": "Energy price per kWh",
          "is_tax_inclusive": true,
          "price_id": "price#4-comp#2",
          "pricing_model": "per_unit",
          "product_id": "prod-id#1234",
          "quantity": 1,
          "taxes": Array [
            Object {
              "amount": 5,
              "tax": Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "6",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 6,
                "type": "VAT",
              },
            },
          ],
          "type": "recurring",
          "unit_amount": 45,
          "unit_amount_decimal": "0.45",
          "unit_amount_gross": 45,
          "unit_amount_gross_decimal": "0.45",
          "unit_amount_net": 42,
          "unit_amount_net_decimal": "0.424528301887",
        },
        Object {
          "_price": Object {
            "_id": "price#4-comp#3",
            "_title": "Wallbox 11 kW",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "weekly",
            "description": "Wallbox 11 kW",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "sales_tax": "standard",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "19",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 19,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "one_time",
            "unit_amount": 50000,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "500.00",
          },
          "_product": Object {},
          "amount_subtotal": 84034,
          "amount_subtotal_decimal": "840.336134453782",
          "amount_tax": 15966,
          "amount_total": 100000,
          "amount_total_decimal": "1000",
          "currency": "EUR",
          "description": "Wallbox 11 kW",
          "is_tax_inclusive": true,
          "price_id": "price#4-comp#3",
          "pricing_model": "per_unit",
          "product_id": "prod-id#1234",
          "quantity": 1,
          "taxes": Array [
            Object {
              "amount": 15966,
              "tax": Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "19",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 19,
                "type": "VAT",
              },
            },
          ],
          "type": "one_time",
          "unit_amount": 50000,
          "unit_amount_decimal": "500.00",
          "unit_amount_gross": 50000,
          "unit_amount_gross_decimal": "500",
          "unit_amount_net": 42017,
          "unit_amount_net_decimal": "420.168067226891",
        },
      ],
      "price_id": "price#4",
      "product_id": "prod-id#1234",
      "quantity": 2,
      "total_details": Object {
        "amount_tax": 16166,
        "breakdown": Object {
          "recurrences": Array [
            Object {
              "amount_subtotal": 2029,
              "amount_subtotal_decimal": "20.285420240138",
              "amount_tax": 199,
              "amount_total": 2228,
              "amount_total_decimal": "22.28",
              "billing_period": "monthly",
              "type": "recurring",
              "unit_amount_gross": 1114,
              "unit_amount_net": 1014,
            },
            Object {
              "amount_subtotal": 84034,
              "amount_subtotal_decimal": "840.336134453782",
              "amount_tax": 15966,
              "amount_total": 100000,
              "amount_total_decimal": "1000",
              "type": "one_time",
              "unit_amount_gross": 50000,
              "unit_amount_net": 42017,
            },
          ],
          "recurrencesByTax": Array [
            Object {
              "amount_subtotal": 1944,
              "amount_tax": 194,
              "amount_total": 2138,
              "billing_period": "monthly",
              "tax": Object {
                "amount": 194,
                "tax": Object {
                  "_id": "10",
                  "rate": 10,
                  "type": "VAT",
                },
              },
              "type": "recurring",
            },
            Object {
              "amount_subtotal": 85,
              "amount_tax": 5,
              "amount_total": 90,
              "billing_period": "monthly",
              "tax": Object {
                "amount": 5,
                "tax": Object {
                  "_id": "6",
                  "rate": 6,
                  "type": "VAT",
                },
              },
              "type": "recurring",
            },
            Object {
              "amount_subtotal": 84034,
              "amount_tax": 15966,
              "amount_total": 100000,
              "tax": Object {
                "amount": 15966,
                "tax": Object {
                  "_id": "19",
                  "rate": 19,
                  "type": "VAT",
                },
              },
              "type": "one_time",
            },
          ],
          "taxes": Array [
            Object {
              "amount": 194,
              "tax": Object {
                "_id": "10",
                "rate": 10,
                "type": "VAT",
              },
            },
            Object {
              "amount": 5,
              "tax": Object {
                "_id": "6",
                "rate": 6,
                "type": "VAT",
              },
            },
            Object {
              "amount": 15966,
              "tax": Object {
                "_id": "19",
                "rate": 19,
                "type": "VAT",
              },
            },
          ],
        },
      },
    },
  ],
  "total_details": Object {
    "amount_tax": 16166,
    "breakdown": Object {
      "recurrences": Array [
        Object {
          "amount_subtotal": 2029,
          "amount_subtotal_decimal": "20.285420240138",
          "amount_tax": 199,
          "amount_total": 2228,
          "amount_total_decimal": "22.28",
          "billing_period": "monthly",
          "type": "recurring",
          "unit_amount_gross": 1114,
          "unit_amount_net": 1014,
        },
        Object {
          "amount_subtotal": 84034,
          "amount_subtotal_decimal": "840.336134453782",
          "amount_tax": 15966,
          "amount_total": 100000,
          "amount_total_decimal": "1000",
          "type": "one_time",
          "unit_amount_gross": 50000,
          "unit_amount_net": 42017,
        },
      ],
      "recurrencesByTax": Array [
        Object {
          "amount_subtotal": 1944,
          "amount_tax": 194,
          "amount_total": 2138,
          "billing_period": "monthly",
          "tax": Object {
            "amount": 194,
            "tax": Object {
              "_id": "10",
              "rate": 10,
              "type": "VAT",
            },
          },
          "type": "recurring",
        },
        Object {
          "amount_subtotal": 85,
          "amount_tax": 5,
          "amount_total": 90,
          "billing_period": "monthly",
          "tax": Object {
            "amount": 5,
            "tax": Object {
              "_id": "6",
              "rate": 6,
              "type": "VAT",
            },
          },
          "type": "recurring",
        },
        Object {
          "amount_subtotal": 84034,
          "amount_tax": 15966,
          "amount_total": 100000,
          "tax": Object {
            "amount": 15966,
            "tax": Object {
              "_id": "19",
              "rate": 19,
              "type": "VAT",
            },
          },
          "type": "one_time",
        },
      ],
      "taxes": Array [
        Object {
          "amount": 194,
          "tax": Object {
            "_id": "10",
            "rate": 10,
            "type": "VAT",
          },
        },
        Object {
          "amount": 5,
          "tax": Object {
            "_id": "6",
            "rate": 6,
            "type": "VAT",
          },
        },
        Object {
          "amount": 15966,
          "tax": Object {
            "_id": "19",
            "rate": 19,
            "type": "VAT",
          },
        },
      ],
    },
  },
}
`;

exports[`computeAggregatedAndPriceTotals when is_composite_price = true should return the right result when there is one composite price with total_details already set 1`] = `
Object {
  "amount_subtotal": 86062,
  "amount_tax": 16166,
  "amount_total": 102228,
  "currency": "EUR",
  "items": Array [
    Object {
      "_price": Object {
        "_id": "price#4",
        "_tags": Array [
          "composite",
        ],
        "_title": "Eletricity Pack 1",
        "active": true,
        "description": "Eletricity Pack 1",
        "is_composite_price": true,
        "price_components": Array [
          Object {
            "_id": "price#4-comp#1",
            "_title": "Base price per month",
            "active": true,
            "billing_duration_amount": 18,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Base price per month",
            "is_tax_inclusive": true,
            "notice_time_amount": 16,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_amount": 18,
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            ],
            "termination_time_amount": 16,
            "termination_time_unit": "months",
            "type": "recurring",
            "unit_amount": 1069,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "10.69",
          },
          Object {
            "_id": "price#4-comp#2",
            "_title": "Energy price per kWh",
            "active": true,
            "billing_duration_amount": 18,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Energy price per kWh",
            "is_tax_inclusive": true,
            "notice_time_amount": 16,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_amount": 18,
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "6",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 6,
                "type": "VAT",
              },
            ],
            "termination_time_amount": 18,
            "termination_time_unit": "months",
            "type": "recurring",
            "unit": "kwh",
            "unit_amount": 45,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "0.45",
            "variable_price": true,
          },
          Object {
            "_id": "price#4-comp#3",
            "_title": "Wallbox 11 kW",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "weekly",
            "description": "Wallbox 11 kW",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "sales_tax": "standard",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "19",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 19,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "one_time",
            "unit_amount": 50000,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "500.00",
          },
        ],
        "price_display_in_journeys": "show_price",
        "pricing_model": "per_unit",
        "sales_tax": "standard",
        "type": "one_time",
        "unit_amount_currency": "EUR",
      },
      "_product": Object {},
      "amount_subtotal": 86062,
      "amount_subtotal_decimal": "860.62155469392",
      "amount_tax": 16166,
      "amount_total": 102228,
      "amount_total_decimal": "1022.28",
      "currency": "EUR",
      "description": "Eletricity Pack 1",
      "item_components": Array [
        Object {
          "_price": Object {
            "_id": "price#4-comp#1",
            "_title": "Base price per month",
            "active": true,
            "billing_duration_amount": 18,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Base price per month",
            "is_tax_inclusive": true,
            "notice_time_amount": 16,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_amount": 18,
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            ],
            "termination_time_amount": 16,
            "termination_time_unit": "months",
            "type": "recurring",
            "unit_amount": 1069,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "10.69",
          },
          "_product": Object {},
          "amount_subtotal": 1944,
          "amount_subtotal_decimal": "19.436363636364",
          "amount_tax": 194,
          "amount_total": 2138,
          "amount_total_decimal": "21.38",
          "billing_period": "monthly",
          "currency": "EUR",
          "description": "Base price per month",
          "is_tax_inclusive": true,
          "price_id": "price#4-comp#1",
          "pricing_model": "per_unit",
          "product_id": "prod-id#1234",
          "quantity": 1,
          "taxes": Array [
            Object {
              "amount": 194,
              "tax": Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            },
          ],
          "type": "recurring",
          "unit_amount": 1069,
          "unit_amount_decimal": "10.69",
          "unit_amount_gross": 1069,
          "unit_amount_gross_decimal": "10.69",
          "unit_amount_net": 972,
          "unit_amount_net_decimal": "9.718181818182",
        },
        Object {
          "_price": Object {
            "_id": "price#4-comp#2",
            "_title": "Energy price per kWh",
            "active": true,
            "billing_duration_amount": 18,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Energy price per kWh",
            "is_tax_inclusive": true,
            "notice_time_amount": 16,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_amount": 18,
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "6",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 6,
                "type": "VAT",
              },
            ],
            "termination_time_amount": 18,
            "termination_time_unit": "months",
            "type": "recurring",
            "unit": "kwh",
            "unit_amount": 45,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "0.45",
            "variable_price": true,
          },
          "_product": Object {},
          "amount_subtotal": 85,
          "amount_subtotal_decimal": "0.849056603774",
          "amount_tax": 5,
          "amount_total": 90,
          "amount_total_decimal": "0.9",
          "billing_period": "monthly",
          "currency": "EUR",
          "description": "Energy price per kWh",
          "is_tax_inclusive": true,
          "price_id": "price#4-comp#2",
          "pricing_model": "per_unit",
          "product_id": "prod-id#1234",
          "quantity": 1,
          "taxes": Array [
            Object {
              "amount": 5,
              "tax": Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "6",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 6,
                "type": "VAT",
              },
            },
          ],
          "type": "recurring",
          "unit_amount": 45,
          "unit_amount_decimal": "0.45",
          "unit_amount_gross": 45,
          "unit_amount_gross_decimal": "0.45",
          "unit_amount_net": 42,
          "unit_amount_net_decimal": "0.424528301887",
        },
        Object {
          "_price": Object {
            "_id": "price#4-comp#3",
            "_title": "Wallbox 11 kW",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "weekly",
            "description": "Wallbox 11 kW",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "sales_tax": "standard",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "19",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 19,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "one_time",
            "unit_amount": 50000,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "500.00",
          },
          "_product": Object {},
          "amount_subtotal": 84034,
          "amount_subtotal_decimal": "840.336134453782",
          "amount_tax": 15966,
          "amount_total": 100000,
          "amount_total_decimal": "1000",
          "currency": "EUR",
          "description": "Wallbox 11 kW",
          "is_tax_inclusive": true,
          "price_id": "price#4-comp#3",
          "pricing_model": "per_unit",
          "product_id": "prod-id#1234",
          "quantity": 1,
          "taxes": Array [
            Object {
              "amount": 15966,
              "tax": Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "19",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 19,
                "type": "VAT",
              },
            },
          ],
          "type": "one_time",
          "unit_amount": 50000,
          "unit_amount_decimal": "500.00",
          "unit_amount_gross": 50000,
          "unit_amount_gross_decimal": "500",
          "unit_amount_net": 42017,
          "unit_amount_net_decimal": "420.168067226891",
        },
      ],
      "price_id": "price#4",
      "product_id": "prod-id#1234",
      "quantity": 2,
      "total_details": Object {
        "amount_tax": 16166,
        "breakdown": Object {
          "recurrences": Array [
            Object {
              "amount_subtotal": 2029,
              "amount_subtotal_decimal": "20.285420240138",
              "amount_tax": 199,
              "amount_total": 2228,
              "amount_total_decimal": "22.28",
              "billing_period": "monthly",
              "type": "recurring",
              "unit_amount_gross": 1114,
              "unit_amount_net": 1014,
            },
            Object {
              "amount_subtotal": 84034,
              "amount_subtotal_decimal": "840.336134453782",
              "amount_tax": 15966,
              "amount_total": 100000,
              "amount_total_decimal": "1000",
              "type": "one_time",
              "unit_amount_gross": 50000,
              "unit_amount_net": 42017,
            },
          ],
          "recurrencesByTax": Array [
            Object {
              "amount_subtotal": 1944,
              "amount_tax": 194,
              "amount_total": 2138,
              "billing_period": "monthly",
              "tax": Object {
                "amount": 194,
                "tax": Object {
                  "_id": "10",
                  "rate": 10,
                  "type": "VAT",
                },
              },
              "type": "recurring",
            },
            Object {
              "amount_subtotal": 85,
              "amount_tax": 5,
              "amount_total": 90,
              "billing_period": "monthly",
              "tax": Object {
                "amount": 5,
                "tax": Object {
                  "_id": "6",
                  "rate": 6,
                  "type": "VAT",
                },
              },
              "type": "recurring",
            },
            Object {
              "amount_subtotal": 84034,
              "amount_tax": 15966,
              "amount_total": 100000,
              "tax": Object {
                "amount": 15966,
                "tax": Object {
                  "_id": "19",
                  "rate": 19,
                  "type": "VAT",
                },
              },
              "type": "one_time",
            },
          ],
          "taxes": Array [
            Object {
              "amount": 194,
              "tax": Object {
                "_id": "10",
                "rate": 10,
                "type": "VAT",
              },
            },
            Object {
              "amount": 5,
              "tax": Object {
                "_id": "6",
                "rate": 6,
                "type": "VAT",
              },
            },
            Object {
              "amount": 15966,
              "tax": Object {
                "_id": "19",
                "rate": 19,
                "type": "VAT",
              },
            },
          ],
        },
      },
    },
  ],
  "total_details": Object {
    "amount_tax": 16166,
    "breakdown": Object {
      "recurrences": Array [
        Object {
          "amount_subtotal": 2029,
          "amount_subtotal_decimal": "20.285420240138",
          "amount_tax": 199,
          "amount_total": 2228,
          "amount_total_decimal": "22.28",
          "billing_period": "monthly",
          "type": "recurring",
          "unit_amount_gross": 1114,
          "unit_amount_net": 1014,
        },
        Object {
          "amount_subtotal": 84034,
          "amount_subtotal_decimal": "840.336134453782",
          "amount_tax": 15966,
          "amount_total": 100000,
          "amount_total_decimal": "1000",
          "type": "one_time",
          "unit_amount_gross": 50000,
          "unit_amount_net": 42017,
        },
      ],
      "recurrencesByTax": Array [
        Object {
          "amount_subtotal": 1944,
          "amount_tax": 194,
          "amount_total": 2138,
          "billing_period": "monthly",
          "tax": Object {
            "amount": 194,
            "tax": Object {
              "_id": "10",
              "rate": 10,
              "type": "VAT",
            },
          },
          "type": "recurring",
        },
        Object {
          "amount_subtotal": 85,
          "amount_tax": 5,
          "amount_total": 90,
          "billing_period": "monthly",
          "tax": Object {
            "amount": 5,
            "tax": Object {
              "_id": "6",
              "rate": 6,
              "type": "VAT",
            },
          },
          "type": "recurring",
        },
        Object {
          "amount_subtotal": 84034,
          "amount_tax": 15966,
          "amount_total": 100000,
          "tax": Object {
            "amount": 15966,
            "tax": Object {
              "_id": "19",
              "rate": 19,
              "type": "VAT",
            },
          },
          "type": "one_time",
        },
      ],
      "taxes": Array [
        Object {
          "amount": 194,
          "tax": Object {
            "_id": "10",
            "rate": 10,
            "type": "VAT",
          },
        },
        Object {
          "amount": 5,
          "tax": Object {
            "_id": "6",
            "rate": 6,
            "type": "VAT",
          },
        },
        Object {
          "amount": 15966,
          "tax": Object {
            "_id": "19",
            "rate": 19,
            "type": "VAT",
          },
        },
      ],
    },
  },
}
`;

exports[`computeAggregatedAndPriceTotals when is_composite_price = true should return the right result when there is one composite price with unit_amount=0 1`] = `
Object {
  "amount_subtotal": 972,
  "amount_tax": 97,
  "amount_total": 1069,
  "currency": "EUR",
  "items": Array [
    Object {
      "_price": Object {
        "_id": "price#4",
        "_tags": Array [
          "composite",
        ],
        "_title": "Eletricity Pack 1",
        "active": true,
        "description": "Eletricity Pack 1",
        "is_composite_price": true,
        "price_components": Array [
          Object {
            "_id": "price#4-comp#1",
            "_title": "Base price per month",
            "active": true,
            "billing_duration_amount": 18,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Base price per month",
            "is_tax_inclusive": true,
            "notice_time_amount": 16,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_amount": 18,
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            ],
            "termination_time_amount": 16,
            "termination_time_unit": "months",
            "type": "recurring",
            "unit_amount": 1069,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "10.69",
          },
          Object {
            "_id": "price#4-comp#2",
            "_title": "Energy price per kWh",
            "active": true,
            "billing_duration_amount": 18,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Energy price per kWh",
            "is_tax_inclusive": true,
            "notice_time_amount": 16,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_amount": 18,
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "6",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 6,
                "type": "VAT",
              },
            ],
            "termination_time_amount": 18,
            "termination_time_unit": "months",
            "type": "recurring",
            "unit": "kwh",
            "unit_amount": 0,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "0.00",
            "variable_price": true,
          },
        ],
        "price_display_in_journeys": "show_price",
        "pricing_model": "per_unit",
        "sales_tax": "standard",
        "type": "one_time",
        "unit_amount_currency": "EUR",
      },
      "_product": Object {},
      "amount_subtotal": 972,
      "amount_subtotal_decimal": "9.718181818182",
      "amount_tax": 97,
      "amount_total": 1069,
      "amount_total_decimal": "10.69",
      "currency": "EUR",
      "description": "Eletricity Pack 1",
      "item_components": Array [
        Object {
          "_price": Object {
            "_id": "price#4-comp#1",
            "_title": "Base price per month",
            "active": true,
            "billing_duration_amount": 18,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Base price per month",
            "is_tax_inclusive": true,
            "notice_time_amount": 16,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_amount": 18,
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            ],
            "termination_time_amount": 16,
            "termination_time_unit": "months",
            "type": "recurring",
            "unit_amount": 1069,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "10.69",
          },
          "_product": Object {},
          "amount_subtotal": 972,
          "amount_subtotal_decimal": "9.718181818182",
          "amount_tax": 97,
          "amount_total": 1069,
          "amount_total_decimal": "10.69",
          "billing_period": "monthly",
          "currency": "EUR",
          "description": "Base price per month",
          "is_tax_inclusive": true,
          "price_id": "price#4-comp#1",
          "pricing_model": "per_unit",
          "product_id": "prod-id#1234",
          "quantity": 1,
          "taxes": Array [
            Object {
              "amount": 97,
              "tax": Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            },
          ],
          "type": "recurring",
          "unit_amount": 1069,
          "unit_amount_decimal": "10.69",
          "unit_amount_gross": 1069,
          "unit_amount_gross_decimal": "10.69",
          "unit_amount_net": 972,
          "unit_amount_net_decimal": "9.718181818182",
        },
        Object {
          "_price": Object {
            "_id": "price#4-comp#2",
            "_title": "Energy price per kWh",
            "active": true,
            "billing_duration_amount": 18,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Energy price per kWh",
            "is_tax_inclusive": true,
            "notice_time_amount": 16,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_amount": 18,
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "6",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 6,
                "type": "VAT",
              },
            ],
            "termination_time_amount": 18,
            "termination_time_unit": "months",
            "type": "recurring",
            "unit": "kwh",
            "unit_amount": 0,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "0.00",
            "variable_price": true,
          },
          "_product": Object {},
          "amount_subtotal": 0,
          "amount_subtotal_decimal": "0",
          "amount_tax": 0,
          "amount_total": 0,
          "amount_total_decimal": "0",
          "billing_period": "monthly",
          "currency": "EUR",
          "description": "Energy price per kWh",
          "is_tax_inclusive": true,
          "price_id": "price#4-comp#2",
          "pricing_model": "per_unit",
          "product_id": "prod-id#1234",
          "quantity": 1,
          "taxes": Array [
            Object {
              "amount": 0,
              "tax": Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "6",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 6,
                "type": "VAT",
              },
            },
          ],
          "type": "recurring",
          "unit_amount": 0,
          "unit_amount_decimal": "0.00",
          "unit_amount_gross": 0,
          "unit_amount_gross_decimal": "0",
          "unit_amount_net": 0,
          "unit_amount_net_decimal": "0",
        },
      ],
      "price_id": "price#4",
      "product_id": "prod-id#1234",
      "quantity": 1,
      "total_details": Object {
        "amount_tax": 97,
        "breakdown": Object {
          "recurrences": Array [
            Object {
              "amount_subtotal": 972,
              "amount_subtotal_decimal": "9.718181818182",
              "amount_tax": 97,
              "amount_total": 1069,
              "amount_total_decimal": "10.69",
              "billing_period": "monthly",
              "type": "recurring",
              "unit_amount_gross": 1069,
              "unit_amount_net": 972,
            },
          ],
          "recurrencesByTax": Array [
            Object {
              "amount_subtotal": 972,
              "amount_tax": 97,
              "amount_total": 1069,
              "billing_period": "monthly",
              "tax": Object {
                "amount": 97,
                "tax": Object {
                  "_id": "10",
                  "rate": 10,
                  "type": "VAT",
                },
              },
              "type": "recurring",
            },
            Object {
              "amount_subtotal": 0,
              "amount_tax": 0,
              "amount_total": 0,
              "billing_period": "monthly",
              "tax": Object {
                "amount": 0,
                "tax": Object {
                  "_id": "6",
                  "rate": 6,
                  "type": "VAT",
                },
              },
              "type": "recurring",
            },
          ],
          "taxes": Array [
            Object {
              "amount": 97,
              "tax": Object {
                "_id": "10",
                "rate": 10,
                "type": "VAT",
              },
            },
            Object {
              "amount": 0,
              "tax": Object {
                "_id": "6",
                "rate": 6,
                "type": "VAT",
              },
            },
          ],
        },
      },
    },
  ],
  "total_details": Object {
    "amount_tax": 97,
    "breakdown": Object {
      "recurrences": Array [
        Object {
          "amount_subtotal": 972,
          "amount_subtotal_decimal": "9.718181818182",
          "amount_tax": 97,
          "amount_total": 1069,
          "amount_total_decimal": "10.69",
          "billing_period": "monthly",
          "type": "recurring",
          "unit_amount_gross": 1069,
          "unit_amount_net": 972,
        },
      ],
      "recurrencesByTax": Array [
        Object {
          "amount_subtotal": 972,
          "amount_tax": 97,
          "amount_total": 1069,
          "billing_period": "monthly",
          "tax": Object {
            "amount": 97,
            "tax": Object {
              "_id": "10",
              "rate": 10,
              "type": "VAT",
            },
          },
          "type": "recurring",
        },
        Object {
          "amount_subtotal": 0,
          "amount_tax": 0,
          "amount_total": 0,
          "billing_period": "monthly",
          "tax": Object {
            "amount": 0,
            "tax": Object {
              "_id": "6",
              "rate": 6,
              "type": "VAT",
            },
          },
          "type": "recurring",
        },
      ],
      "taxes": Array [
        Object {
          "amount": 97,
          "tax": Object {
            "_id": "10",
            "rate": 10,
            "type": "VAT",
          },
        },
        Object {
          "amount": 0,
          "tax": Object {
            "_id": "6",
            "rate": 6,
            "type": "VAT",
          },
        },
      ],
    },
  },
}
`;

exports[`computeCompositePrice computes the composite price correctly #1 1`] = `
Object {
  "_price": Object {
    "_id": "price#4",
    "_tags": Array [
      "composite",
    ],
    "_title": "Eletricity Pack 1",
    "active": true,
    "description": "Eletricity Pack 1",
    "is_composite_price": true,
    "price_components": Array [
      Object {
        "_id": "price#4-comp#1",
        "_title": "Base price per month",
        "active": true,
        "billing_duration_amount": 18,
        "billing_duration_unit": "months",
        "billing_period": "monthly",
        "description": "Base price per month",
        "is_tax_inclusive": true,
        "notice_time_amount": 16,
        "notice_time_unit": "months",
        "price_display_in_journeys": "show_price",
        "pricing_model": "per_unit",
        "renewal_duration_amount": 18,
        "renewal_duration_unit": "months",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "10",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 10,
            "type": "VAT",
          },
        ],
        "termination_time_amount": 16,
        "termination_time_unit": "months",
        "type": "recurring",
        "unit_amount": 1069,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "10.69",
      },
      Object {
        "_id": "price#4-comp#2",
        "_title": "Energy price per kWh",
        "active": true,
        "billing_duration_amount": 18,
        "billing_duration_unit": "months",
        "billing_period": "monthly",
        "description": "Energy price per kWh",
        "is_tax_inclusive": true,
        "notice_time_amount": 16,
        "notice_time_unit": "months",
        "price_display_in_journeys": "show_price",
        "pricing_model": "per_unit",
        "renewal_duration_amount": 18,
        "renewal_duration_unit": "months",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "6",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 6,
            "type": "VAT",
          },
        ],
        "termination_time_amount": 18,
        "termination_time_unit": "months",
        "type": "recurring",
        "unit": "kwh",
        "unit_amount": 45,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "0.45",
        "variable_price": true,
      },
      Object {
        "_id": "price#4-comp#3",
        "_title": "Wallbox 11 kW",
        "active": true,
        "billing_duration_unit": "months",
        "billing_period": "weekly",
        "description": "Wallbox 11 kW",
        "is_tax_inclusive": true,
        "notice_time_unit": "months",
        "price_display_in_journeys": "show_price",
        "pricing_model": "per_unit",
        "renewal_duration_unit": "months",
        "sales_tax": "standard",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        ],
        "termination_time_unit": "months",
        "type": "one_time",
        "unit_amount": 50000,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "500.00",
      },
    ],
    "price_display_in_journeys": "show_price",
    "sales_tax": "standard",
    "type": "one_time",
    "unit_amount_currency": "EUR",
  },
  "_product": Object {},
  "currency": "EUR",
  "description": "Eletricity Pack 1",
  "item_components": Array [
    Object {
      "_price": Object {
        "_id": "price#4-comp#1",
        "_title": "Base price per month",
        "active": true,
        "billing_duration_amount": 18,
        "billing_duration_unit": "months",
        "billing_period": "monthly",
        "description": "Base price per month",
        "is_tax_inclusive": true,
        "notice_time_amount": 16,
        "notice_time_unit": "months",
        "price_display_in_journeys": "show_price",
        "pricing_model": "per_unit",
        "renewal_duration_amount": 18,
        "renewal_duration_unit": "months",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "10",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 10,
            "type": "VAT",
          },
        ],
        "termination_time_amount": 16,
        "termination_time_unit": "months",
        "type": "recurring",
        "unit_amount": 1069,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "10.69",
      },
      "_product": Object {},
      "amount_subtotal": 9718181818182,
      "amount_tax": 971818181818,
      "amount_total": 10690000000000,
      "billing_period": "monthly",
      "currency": "EUR",
      "description": "Base price per month",
      "is_tax_inclusive": true,
      "price_id": "price#4-comp#1",
      "pricing_model": "per_unit",
      "product_id": "prod-id#1234",
      "quantity": 1,
      "taxes": Array [
        Object {
          "amount": 971818181818,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "10",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 10,
            "type": "VAT",
          },
        },
      ],
      "type": "recurring",
      "unit_amount": 10690000000000,
      "unit_amount_decimal": "10.69",
      "unit_amount_gross": 10690000000000,
      "unit_amount_gross_decimal": "10.69",
      "unit_amount_net": 9718181818182,
      "unit_amount_net_decimal": "9.718181818182",
    },
    Object {
      "_price": Object {
        "_id": "price#4-comp#2",
        "_title": "Energy price per kWh",
        "active": true,
        "billing_duration_amount": 18,
        "billing_duration_unit": "months",
        "billing_period": "monthly",
        "description": "Energy price per kWh",
        "is_tax_inclusive": true,
        "notice_time_amount": 16,
        "notice_time_unit": "months",
        "price_display_in_journeys": "show_price",
        "pricing_model": "per_unit",
        "renewal_duration_amount": 18,
        "renewal_duration_unit": "months",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "6",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 6,
            "type": "VAT",
          },
        ],
        "termination_time_amount": 18,
        "termination_time_unit": "months",
        "type": "recurring",
        "unit": "kwh",
        "unit_amount": 45,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "0.45",
        "variable_price": true,
      },
      "_product": Object {},
      "amount_subtotal": 424528301887,
      "amount_tax": 25471698113,
      "amount_total": 450000000000,
      "billing_period": "monthly",
      "currency": "EUR",
      "description": "Energy price per kWh",
      "is_tax_inclusive": true,
      "price_id": "price#4-comp#2",
      "pricing_model": "per_unit",
      "product_id": "prod-id#1234",
      "quantity": 1,
      "taxes": Array [
        Object {
          "amount": 25471698113,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "6",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 6,
            "type": "VAT",
          },
        },
      ],
      "type": "recurring",
      "unit_amount": 450000000000,
      "unit_amount_decimal": "0.45",
      "unit_amount_gross": 450000000000,
      "unit_amount_gross_decimal": "0.45",
      "unit_amount_net": 424528301887,
      "unit_amount_net_decimal": "0.424528301887",
    },
    Object {
      "_price": Object {
        "_id": "price#4-comp#3",
        "_title": "Wallbox 11 kW",
        "active": true,
        "billing_duration_unit": "months",
        "billing_period": "weekly",
        "description": "Wallbox 11 kW",
        "is_tax_inclusive": true,
        "notice_time_unit": "months",
        "price_display_in_journeys": "show_price",
        "pricing_model": "per_unit",
        "renewal_duration_unit": "months",
        "sales_tax": "standard",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        ],
        "termination_time_unit": "months",
        "type": "one_time",
        "unit_amount": 50000,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "500.00",
      },
      "_product": Object {},
      "amount_subtotal": 420168067226891,
      "amount_tax": 79831932773109,
      "amount_total": 500000000000000,
      "currency": "EUR",
      "description": "Wallbox 11 kW",
      "is_tax_inclusive": true,
      "price_id": "price#4-comp#3",
      "pricing_model": "per_unit",
      "product_id": "prod-id#1234",
      "quantity": 1,
      "taxes": Array [
        Object {
          "amount": 79831932773109,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        },
      ],
      "type": "one_time",
      "unit_amount": 500000000000000,
      "unit_amount_decimal": "500.00",
      "unit_amount_gross": 500000000000000,
      "unit_amount_gross_decimal": "500",
      "unit_amount_net": 420168067226891,
      "unit_amount_net_decimal": "420.168067226891",
    },
  ],
  "price_id": "price#4",
  "product_id": "prod-id#1234",
  "quantity": 1,
}
`;

exports[`computeCompositePrice computes the composite price correctly #2 1`] = `
Object {
  "_price": Object {
    "_id": "price#4",
    "_tags": Array [
      "composite",
    ],
    "_title": "Eletricity Pack 1",
    "active": true,
    "description": "Eletricity Pack 1",
    "is_composite_price": true,
    "price_components": Array [
      Object {
        "_id": "price#4-comp#1",
        "_title": "Base price per month",
        "active": true,
        "billing_duration_amount": 18,
        "billing_duration_unit": "months",
        "billing_period": "monthly",
        "description": "Base price per month",
        "is_tax_inclusive": true,
        "notice_time_amount": 16,
        "notice_time_unit": "months",
        "price_display_in_journeys": "show_price",
        "pricing_model": "per_unit",
        "renewal_duration_amount": 18,
        "renewal_duration_unit": "months",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "10",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 10,
            "type": "VAT",
          },
        ],
        "termination_time_amount": 16,
        "termination_time_unit": "months",
        "type": "recurring",
        "unit_amount": 1069,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "10.69",
      },
      Object {
        "_id": "price#4-comp#2",
        "_title": "Energy price per kWh",
        "active": true,
        "billing_duration_amount": 18,
        "billing_duration_unit": "months",
        "billing_period": "monthly",
        "description": "Energy price per kWh",
        "is_tax_inclusive": true,
        "notice_time_amount": 16,
        "notice_time_unit": "months",
        "price_display_in_journeys": "show_price",
        "pricing_model": "per_unit",
        "renewal_duration_amount": 18,
        "renewal_duration_unit": "months",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "6",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 6,
            "type": "VAT",
          },
        ],
        "termination_time_amount": 18,
        "termination_time_unit": "months",
        "type": "recurring",
        "unit": "kwh",
        "unit_amount": 45,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "0.45",
        "variable_price": true,
      },
      Object {
        "_id": "price#4-comp#3",
        "_title": "Wallbox 11 kW",
        "active": true,
        "billing_duration_unit": "months",
        "billing_period": "weekly",
        "description": "Wallbox 11 kW",
        "is_tax_inclusive": true,
        "notice_time_unit": "months",
        "price_display_in_journeys": "show_price",
        "pricing_model": "per_unit",
        "renewal_duration_unit": "months",
        "sales_tax": "standard",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        ],
        "termination_time_unit": "months",
        "type": "one_time",
        "unit_amount": 50000,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "500.00",
      },
    ],
    "price_display_in_journeys": "show_price",
    "sales_tax": "standard",
    "type": "one_time",
    "unit_amount_currency": "EUR",
  },
  "_product": Object {},
  "currency": "EUR",
  "description": "Eletricity Pack 1",
  "item_components": Array [
    Object {
      "_price": Object {
        "_id": "price#4-comp#1",
        "_title": "Base price per month",
        "active": true,
        "billing_duration_amount": 18,
        "billing_duration_unit": "months",
        "billing_period": "monthly",
        "description": "Base price per month",
        "is_tax_inclusive": true,
        "notice_time_amount": 16,
        "notice_time_unit": "months",
        "price_display_in_journeys": "show_price",
        "pricing_model": "per_unit",
        "renewal_duration_amount": 18,
        "renewal_duration_unit": "months",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "10",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 10,
            "type": "VAT",
          },
        ],
        "termination_time_amount": 16,
        "termination_time_unit": "months",
        "type": "recurring",
        "unit_amount": 1069,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "10.69",
      },
      "_product": Object {},
      "amount_subtotal": 9718181818182,
      "amount_tax": 971818181818,
      "amount_total": 10690000000000,
      "billing_period": "monthly",
      "currency": "EUR",
      "description": "Base price per month",
      "is_tax_inclusive": true,
      "price_id": "price#4-comp#1",
      "pricing_model": "per_unit",
      "product_id": "prod-id#1234",
      "quantity": 1,
      "taxes": Array [
        Object {
          "amount": 971818181818,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "10",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 10,
            "type": "VAT",
          },
        },
      ],
      "type": "recurring",
      "unit_amount": 10690000000000,
      "unit_amount_decimal": "10.69",
      "unit_amount_gross": 10690000000000,
      "unit_amount_gross_decimal": "10.69",
      "unit_amount_net": 9718181818182,
      "unit_amount_net_decimal": "9.718181818182",
    },
    Object {
      "_price": Object {
        "_id": "price#4-comp#2",
        "_title": "Energy price per kWh",
        "active": true,
        "billing_duration_amount": 18,
        "billing_duration_unit": "months",
        "billing_period": "monthly",
        "description": "Energy price per kWh",
        "is_tax_inclusive": true,
        "notice_time_amount": 16,
        "notice_time_unit": "months",
        "price_display_in_journeys": "show_price",
        "pricing_model": "per_unit",
        "renewal_duration_amount": 18,
        "renewal_duration_unit": "months",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "6",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 6,
            "type": "VAT",
          },
        ],
        "termination_time_amount": 18,
        "termination_time_unit": "months",
        "type": "recurring",
        "unit": "kwh",
        "unit_amount": 45,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "0.45",
        "variable_price": true,
      },
      "_product": Object {},
      "amount_subtotal": 424528301887,
      "amount_tax": 25471698113,
      "amount_total": 450000000000,
      "billing_period": "monthly",
      "currency": "EUR",
      "description": "Energy price per kWh",
      "is_tax_inclusive": true,
      "price_id": "price#4-comp#2",
      "pricing_model": "per_unit",
      "product_id": "prod-id#1234",
      "quantity": 1,
      "taxes": Array [
        Object {
          "amount": 25471698113,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "6",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 6,
            "type": "VAT",
          },
        },
      ],
      "type": "recurring",
      "unit_amount": 450000000000,
      "unit_amount_decimal": "0.45",
      "unit_amount_gross": 450000000000,
      "unit_amount_gross_decimal": "0.45",
      "unit_amount_net": 424528301887,
      "unit_amount_net_decimal": "0.424528301887",
    },
    Object {
      "_price": Object {
        "_id": "price#4-comp#3",
        "_title": "Wallbox 11 kW",
        "active": true,
        "billing_duration_unit": "months",
        "billing_period": "weekly",
        "description": "Wallbox 11 kW",
        "is_tax_inclusive": true,
        "notice_time_unit": "months",
        "price_display_in_journeys": "show_price",
        "pricing_model": "per_unit",
        "renewal_duration_unit": "months",
        "sales_tax": "standard",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        ],
        "termination_time_unit": "months",
        "type": "one_time",
        "unit_amount": 50000,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "500.00",
      },
      "_product": Object {},
      "amount_subtotal": 420168067226891,
      "amount_tax": 79831932773109,
      "amount_total": 500000000000000,
      "currency": "EUR",
      "description": "Wallbox 11 kW",
      "is_tax_inclusive": true,
      "price_id": "price#4-comp#3",
      "pricing_model": "per_unit",
      "product_id": "prod-id#1234",
      "quantity": 1,
      "taxes": Array [
        Object {
          "amount": 79831932773109,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        },
      ],
      "type": "one_time",
      "unit_amount": 500000000000000,
      "unit_amount_decimal": "500.00",
      "unit_amount_gross": 500000000000000,
      "unit_amount_gross_decimal": "500",
      "unit_amount_net": 420168067226891,
      "unit_amount_net_decimal": "420.168067226891",
    },
  ],
  "price_id": "price#4",
  "product_id": "prod-id#1234",
  "quantity": 1,
}
`;

exports[`computePriceItemDetails computes the pricing details for a composite price 1`] = `
Object {
  "amount_subtotal": 43031,
  "amount_tax": 8083,
  "amount_total": 51114,
  "currency": "EUR",
  "items": Array [
    Object {
      "_price": Object {
        "_id": "price#4",
        "_tags": Array [
          "composite",
        ],
        "_title": "Eletricity Pack 1",
        "active": true,
        "description": "Eletricity Pack 1",
        "is_composite_price": true,
        "price_components": Array [
          Object {
            "_id": "price#4-comp#1",
            "_title": "Base price per month",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Base price per month",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "recurring",
            "unit_amount": 1069,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "10.69",
          },
          Object {
            "_id": "price#4-comp#2",
            "_title": "Energy price per kWh",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Energy price per kWh",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "6",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 6,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "recurring",
            "unit": "kwh",
            "unit_amount": 45,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "0.45",
            "variable_price": true,
          },
          Object {
            "_id": "price#4-comp#3",
            "_title": "Wallbox 11 kW",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "weekly",
            "description": "Wallbox 11 kW",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "sales_tax": "standard",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "19",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 19,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "one_time",
            "unit_amount": 50000,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "500.00",
          },
        ],
        "price_display_in_journeys": "show_price",
        "sales_tax": "standard",
        "type": "one_time",
        "unit_amount_currency": "EUR",
      },
      "_product": Object {},
      "amount_subtotal": 43031,
      "amount_subtotal_decimal": "430.31077734696",
      "amount_tax": 8083,
      "amount_total": 51114,
      "amount_total_decimal": "511.14",
      "currency": "EUR",
      "description": "Eletricity Pack 1",
      "item_components": Array [
        Object {
          "_price": Object {
            "_id": "price#4-comp#1",
            "_title": "Base price per month",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Base price per month",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "recurring",
            "unit_amount": 1069,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "10.69",
          },
          "_product": Object {},
          "amount_subtotal": 972,
          "amount_subtotal_decimal": "9.718181818182",
          "amount_tax": 97,
          "amount_total": 1069,
          "amount_total_decimal": "10.69",
          "billing_period": "monthly",
          "currency": "EUR",
          "description": "Base price per month",
          "is_tax_inclusive": true,
          "price_id": "price#4-comp#1",
          "pricing_model": "per_unit",
          "product_id": "prod-id#1234",
          "quantity": 1,
          "taxes": Array [
            Object {
              "amount": 97,
              "tax": Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "10",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 10,
                "type": "VAT",
              },
            },
          ],
          "type": "recurring",
          "unit_amount": 1069,
          "unit_amount_decimal": "10.69",
          "unit_amount_gross": 1069,
          "unit_amount_gross_decimal": "10.69",
          "unit_amount_net": 972,
          "unit_amount_net_decimal": "9.718181818182",
        },
        Object {
          "_price": Object {
            "_id": "price#4-comp#2",
            "_title": "Energy price per kWh",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "Energy price per kWh",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "6",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 6,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "recurring",
            "unit": "kwh",
            "unit_amount": 45,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "0.45",
            "variable_price": true,
          },
          "_product": Object {},
          "amount_subtotal": 42,
          "amount_subtotal_decimal": "0.424528301887",
          "amount_tax": 3,
          "amount_total": 45,
          "amount_total_decimal": "0.45",
          "billing_period": "monthly",
          "currency": "EUR",
          "description": "Energy price per kWh",
          "is_tax_inclusive": true,
          "price_id": "price#4-comp#2",
          "pricing_model": "per_unit",
          "product_id": "prod-id#1234",
          "quantity": 1,
          "taxes": Array [
            Object {
              "amount": 3,
              "tax": Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "6",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 6,
                "type": "VAT",
              },
            },
          ],
          "type": "recurring",
          "unit_amount": 45,
          "unit_amount_decimal": "0.45",
          "unit_amount_gross": 45,
          "unit_amount_gross_decimal": "0.45",
          "unit_amount_net": 42,
          "unit_amount_net_decimal": "0.424528301887",
        },
        Object {
          "_price": Object {
            "_id": "price#4-comp#3",
            "_title": "Wallbox 11 kW",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "weekly",
            "description": "Wallbox 11 kW",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "sales_tax": "standard",
            "tax": Array [
              Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "19",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 19,
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "one_time",
            "unit_amount": 50000,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "500.00",
          },
          "_product": Object {},
          "amount_subtotal": 42017,
          "amount_subtotal_decimal": "420.168067226891",
          "amount_tax": 7983,
          "amount_total": 50000,
          "amount_total_decimal": "500",
          "currency": "EUR",
          "description": "Wallbox 11 kW",
          "is_tax_inclusive": true,
          "price_id": "price#4-comp#3",
          "pricing_model": "per_unit",
          "product_id": "prod-id#1234",
          "quantity": 1,
          "taxes": Array [
            Object {
              "amount": 7983,
              "tax": Object {
                "_created_at": "2022-06-29T20:26:19.020Z",
                "_id": "19",
                "_org": "739224",
                "_schema": "tax",
                "_title": "",
                "_updated_at": "2022-06-29T20:26:19.020Z",
                "rate": 19,
                "type": "VAT",
              },
            },
          ],
          "type": "one_time",
          "unit_amount": 50000,
          "unit_amount_decimal": "500.00",
          "unit_amount_gross": 50000,
          "unit_amount_gross_decimal": "500",
          "unit_amount_net": 42017,
          "unit_amount_net_decimal": "420.168067226891",
        },
      ],
      "price_id": "price#4",
      "product_id": "prod-id#1234",
      "quantity": 1,
      "total_details": Object {
        "amount_tax": 8083,
        "breakdown": Object {
          "recurrences": Array [
            Object {
              "amount_subtotal": 1014,
              "amount_subtotal_decimal": "10.142710120069",
              "amount_tax": 100,
              "amount_total": 1114,
              "amount_total_decimal": "11.14",
              "billing_period": "monthly",
              "type": "recurring",
              "unit_amount_gross": 1114,
              "unit_amount_net": 1014,
            },
            Object {
              "amount_subtotal": 42017,
              "amount_subtotal_decimal": "420.168067226891",
              "amount_tax": 7983,
              "amount_total": 50000,
              "amount_total_decimal": "500",
              "type": "one_time",
              "unit_amount_gross": 50000,
              "unit_amount_net": 42017,
            },
          ],
          "recurrencesByTax": Array [
            Object {
              "amount_subtotal": 972,
              "amount_tax": 97,
              "amount_total": 1069,
              "billing_period": "monthly",
              "tax": Object {
                "amount": 97,
                "tax": Object {
                  "_id": "10",
                  "rate": 10,
                  "type": "VAT",
                },
              },
              "type": "recurring",
            },
            Object {
              "amount_subtotal": 42,
              "amount_tax": 3,
              "amount_total": 45,
              "billing_period": "monthly",
              "tax": Object {
                "amount": 3,
                "tax": Object {
                  "_id": "6",
                  "rate": 6,
                  "type": "VAT",
                },
              },
              "type": "recurring",
            },
            Object {
              "amount_subtotal": 42017,
              "amount_tax": 7983,
              "amount_total": 50000,
              "tax": Object {
                "amount": 7983,
                "tax": Object {
                  "_id": "19",
                  "rate": 19,
                  "type": "VAT",
                },
              },
              "type": "one_time",
            },
          ],
          "taxes": Array [
            Object {
              "amount": 97,
              "tax": Object {
                "_id": "10",
                "rate": 10,
                "type": "VAT",
              },
            },
            Object {
              "amount": 3,
              "tax": Object {
                "_id": "6",
                "rate": 6,
                "type": "VAT",
              },
            },
            Object {
              "amount": 7983,
              "tax": Object {
                "_id": "19",
                "rate": 19,
                "type": "VAT",
              },
            },
          ],
        },
      },
    },
  ],
  "total_details": Object {
    "amount_tax": 8083,
    "breakdown": Object {
      "recurrences": Array [
        Object {
          "amount_subtotal": 1014,
          "amount_subtotal_decimal": "10.142710120069",
          "amount_tax": 100,
          "amount_total": 1114,
          "amount_total_decimal": "11.14",
          "billing_period": "monthly",
          "type": "recurring",
          "unit_amount_gross": 1114,
          "unit_amount_net": 1014,
        },
        Object {
          "amount_subtotal": 42017,
          "amount_subtotal_decimal": "420.168067226891",
          "amount_tax": 7983,
          "amount_total": 50000,
          "amount_total_decimal": "500",
          "type": "one_time",
          "unit_amount_gross": 50000,
          "unit_amount_net": 42017,
        },
      ],
      "recurrencesByTax": Array [
        Object {
          "amount_subtotal": 972,
          "amount_tax": 97,
          "amount_total": 1069,
          "billing_period": "monthly",
          "tax": Object {
            "amount": 97,
            "tax": Object {
              "_id": "10",
              "rate": 10,
              "type": "VAT",
            },
          },
          "type": "recurring",
        },
        Object {
          "amount_subtotal": 42,
          "amount_tax": 3,
          "amount_total": 45,
          "billing_period": "monthly",
          "tax": Object {
            "amount": 3,
            "tax": Object {
              "_id": "6",
              "rate": 6,
              "type": "VAT",
            },
          },
          "type": "recurring",
        },
        Object {
          "amount_subtotal": 42017,
          "amount_tax": 7983,
          "amount_total": 50000,
          "tax": Object {
            "amount": 7983,
            "tax": Object {
              "_id": "19",
              "rate": 19,
              "type": "VAT",
            },
          },
          "type": "one_time",
        },
      ],
      "taxes": Array [
        Object {
          "amount": 97,
          "tax": Object {
            "_id": "10",
            "rate": 10,
            "type": "VAT",
          },
        },
        Object {
          "amount": 3,
          "tax": Object {
            "_id": "6",
            "rate": 6,
            "type": "VAT",
          },
        },
        Object {
          "amount": 7983,
          "tax": Object {
            "_id": "19",
            "rate": 19,
            "type": "VAT",
          },
        },
      ],
    },
  },
}
`;

exports[`computePriceItemDetails computes the pricing details for a composite price that one component has changed its tax 1`] = `
Object {
  "amount_subtotal": 27,
  "amount_tax": 3,
  "amount_total": 30,
  "currency": "EUR",
  "items": Array [
    Object {
      "_price": Object {
        "_id": "8a3ceebd-4123-4cb8-9c53-9e006ed702d6",
        "_tags": Array [
          "composite",
        ],
        "_title": "composite",
        "active": true,
        "billing_duration_unit": "months",
        "billing_period": "weekly",
        "description": "composite",
        "is_composite_price": true,
        "is_tax_inclusive": true,
        "notice_time_unit": "months",
        "price_components": Array [
          Object {
            "_id": "ac541a5a-9a90-4d55-9895-a9fd278203a6",
            "_title": "one time variable",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "weekly",
            "description": "one time variable",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "sales_tax": "standard",
            "tax": Object {
              "$relation": Array [
                Object {
                  "entity_id": "79cac814-18c8-4047-ae45-1d0828598a18",
                },
              ],
            },
            "termination_time_unit": "months",
            "type": "one_time",
            "unit": "",
            "unit_amount": 10,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "0.1",
            "variable_price": true,
          },
          Object {
            "_id": "bd0b8da9-6d91-46e3-b0b5-91dcffd4e0d3",
            "_title": "monthly variable",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "monthly variable",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "sales_tax": "standard",
            "tax": Object {
              "$relation": Array [
                Object {
                  "entity_id": "d05c030b-1515-4c38-85fa-d2b9c3114608",
                },
              ],
            },
            "termination_time_unit": "months",
            "type": "recurring",
            "unit": "kw",
            "unit_amount": 20,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "0.2",
            "variable_price": true,
          },
        ],
        "price_display_in_journeys": "show_price",
        "renewal_duration_unit": "months",
        "sales_tax": "standard",
        "termination_time_unit": "months",
        "type": "one_time",
        "unit_amount": 0,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "0.00",
      },
      "_product": Object {
        "_id": "f7edb33a-18f1-49ad-af3a-fa8487286288",
        "_title": "Simple price",
        "feature": Array [
          Object {
            "feature": "Feature 1",
          },
          Object {
            "feature": "Feature 2",
          },
          Object {
            "feature": "Feature 3",
          },
        ],
        "name": "Simple price",
        "price_options": Object {
          "$relation": Array [
            Object {},
            Object {},
          ],
        },
        "type": "product",
      },
      "amount_subtotal": 27,
      "amount_subtotal_decimal": "0.268067226891",
      "amount_tax": 3,
      "amount_total": 30,
      "amount_total_decimal": "0.3",
      "currency": "EUR",
      "description": "composite",
      "item_components": Array [
        Object {
          "_price": Object {
            "_id": "ac541a5a-9a90-4d55-9895-a9fd278203a6",
            "_title": "one time variable",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "weekly",
            "description": "one time variable",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "sales_tax": "standard",
            "tax": Array [
              Object {
                "_created_at": "2022-04-26T08:41:38.696Z",
                "_id": "79cac814-18c8-4047-ae45-1d0828598a18",
                "_org": "739224",
                "_schema": "tax",
                "_title": "Tax GST",
                "_updated_at": "2022-04-26T08:41:38.696Z",
                "active": true,
                "description": "GST",
                "rate": 19,
                "region": "DE",
                "type": "Custom",
              },
            ],
            "termination_time_unit": "months",
            "type": "one_time",
            "unit": "",
            "unit_amount": 10,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "0.1",
            "variable_price": true,
          },
          "_product": Object {
            "_id": "f7edb33a-18f1-49ad-af3a-fa8487286288",
            "_title": "Simple price",
            "feature": Array [
              Object {
                "feature": "Feature 1",
              },
              Object {
                "feature": "Feature 2",
              },
              Object {
                "feature": "Feature 3",
              },
            ],
            "name": "Simple price",
            "price_options": Object {
              "$relation": Array [
                Object {},
                Object {},
              ],
            },
            "type": "product",
          },
          "amount_subtotal": 10,
          "amount_subtotal_decimal": "0.1",
          "amount_tax": 0,
          "amount_total": 10,
          "amount_total_decimal": "0.1",
          "currency": "EUR",
          "description": "one time variable",
          "is_tax_inclusive": true,
          "price_id": "ac541a5a-9a90-4d55-9895-a9fd278203a6",
          "pricing_model": "per_unit",
          "product_id": "f7edb33a-18f1-49ad-af3a-fa8487286288",
          "quantity": 1,
          "taxes": Array [
            Object {
              "amount": 0,
              "rate": "nontaxable",
              "rateValue": 0,
            },
          ],
          "type": "one_time",
          "unit_amount": 10,
          "unit_amount_decimal": "0.1",
          "unit_amount_gross": 10,
          "unit_amount_gross_decimal": "0.1",
          "unit_amount_net": 10,
          "unit_amount_net_decimal": "0.1",
        },
        Object {
          "_price": Object {
            "_id": "bd0b8da9-6d91-46e3-b0b5-91dcffd4e0d3",
            "_title": "monthly variable",
            "active": true,
            "billing_duration_unit": "months",
            "billing_period": "monthly",
            "description": "monthly variable",
            "is_tax_inclusive": true,
            "notice_time_unit": "months",
            "price_display_in_journeys": "show_price",
            "pricing_model": "per_unit",
            "renewal_duration_unit": "months",
            "sales_tax": "standard",
            "tax": Array [
              Object {
                "_created_at": "2021-09-22T23:23:15.195Z",
                "_id": "d05c030b-1515-4c38-85fa-d2b9c3114608",
                "_org": "739224",
                "_schema": "tax",
                "_tags": Array [
                  "german - tax",
                ],
                "_title": "Tax MwSt. 7%",
                "_updated_at": "2022-01-24T14:09:26.391Z",
                "active": true,
                "description": "MwSt. 7%",
                "rate": 7,
                "region": "DE",
                "region_label": "All Regions",
                "type": "VAT",
              },
            ],
            "termination_time_unit": "months",
            "type": "recurring",
            "unit": "kw",
            "unit_amount": 20,
            "unit_amount_currency": "EUR",
            "unit_amount_decimal": "0.2",
            "variable_price": true,
          },
          "_product": Object {
            "_id": "f7edb33a-18f1-49ad-af3a-fa8487286288",
            "_title": "Simple price",
            "feature": Array [
              Object {
                "feature": "Feature 1",
              },
              Object {
                "feature": "Feature 2",
              },
              Object {
                "feature": "Feature 3",
              },
            ],
            "name": "Simple price",
            "price_options": Object {
              "$relation": Array [
                Object {},
                Object {},
              ],
            },
            "type": "product",
          },
          "amount_subtotal": 17,
          "amount_subtotal_decimal": "0.168067226891",
          "amount_tax": 3,
          "amount_total": 20,
          "amount_total_decimal": "0.2",
          "billing_period": "monthly",
          "currency": "EUR",
          "description": "monthly variable",
          "is_tax_inclusive": true,
          "price_id": "bd0b8da9-6d91-46e3-b0b5-91dcffd4e0d3",
          "pricing_model": "per_unit",
          "product_id": "f7edb33a-18f1-49ad-af3a-fa8487286288",
          "quantity": 1,
          "taxes": Array [
            Object {
              "amount": 3,
              "tax": Object {
                "_created_at": "2022-04-26T08:41:38.696Z",
                "_id": "79cac814-18c8-4047-ae45-1d0828598a18",
                "_org": "739224",
                "_schema": "tax",
                "_title": "Tax GST",
                "_updated_at": "2022-04-26T08:41:38.696Z",
                "active": true,
                "description": "GST",
                "rate": 19,
                "region": "DE",
                "type": "Custom",
              },
            },
          ],
          "type": "recurring",
          "unit_amount": 20,
          "unit_amount_decimal": "0.2",
          "unit_amount_gross": 20,
          "unit_amount_gross_decimal": "0.2",
          "unit_amount_net": 17,
          "unit_amount_net_decimal": "0.168067226891",
        },
      ],
      "price_id": "8a3ceebd-4123-4cb8-9c53-9e006ed702d6",
      "product_id": "f7edb33a-18f1-49ad-af3a-fa8487286288",
      "quantity": 1,
      "total_details": Object {
        "amount_tax": 3,
        "breakdown": Object {
          "recurrences": Array [
            Object {
              "amount_subtotal": 10,
              "amount_subtotal_decimal": "0.1",
              "amount_tax": 0,
              "amount_total": 10,
              "amount_total_decimal": "0.1",
              "type": "one_time",
              "unit_amount_gross": 10,
              "unit_amount_net": 10,
            },
            Object {
              "amount_subtotal": 17,
              "amount_subtotal_decimal": "0.168067226891",
              "amount_tax": 3,
              "amount_total": 20,
              "amount_total_decimal": "0.2",
              "billing_period": "monthly",
              "type": "recurring",
              "unit_amount_gross": 20,
              "unit_amount_net": 17,
            },
          ],
          "recurrencesByTax": Array [
            Object {
              "amount_subtotal": 10,
              "amount_tax": 0,
              "amount_total": 10,
              "tax": Object {
                "amount": 0,
                "tax": Object {
                  "rate": 0,
                },
              },
              "type": "one_time",
            },
            Object {
              "amount_subtotal": 17,
              "amount_tax": 3,
              "amount_total": 20,
              "billing_period": "monthly",
              "tax": Object {
                "amount": 3,
                "tax": Object {
                  "_id": "79cac814-18c8-4047-ae45-1d0828598a18",
                  "rate": 19,
                  "type": "Custom",
                },
              },
              "type": "recurring",
            },
          ],
          "taxes": Array [
            Object {
              "amount": 0,
              "tax": Object {
                "rate": 0,
              },
            },
            Object {
              "amount": 3,
              "tax": Object {
                "_id": "79cac814-18c8-4047-ae45-1d0828598a18",
                "rate": 19,
                "type": "Custom",
              },
            },
          ],
        },
      },
    },
  ],
  "total_details": Object {
    "amount_tax": 3,
    "breakdown": Object {
      "recurrences": Array [
        Object {
          "amount_subtotal": 10,
          "amount_subtotal_decimal": "0.1",
          "amount_tax": 0,
          "amount_total": 10,
          "amount_total_decimal": "0.1",
          "type": "one_time",
          "unit_amount_gross": 10,
          "unit_amount_net": 10,
        },
        Object {
          "amount_subtotal": 17,
          "amount_subtotal_decimal": "0.168067226891",
          "amount_tax": 3,
          "amount_total": 20,
          "amount_total_decimal": "0.2",
          "billing_period": "monthly",
          "type": "recurring",
          "unit_amount_gross": 20,
          "unit_amount_net": 17,
        },
      ],
      "recurrencesByTax": Array [
        Object {
          "amount_subtotal": 10,
          "amount_tax": 0,
          "amount_total": 10,
          "tax": Object {
            "amount": 0,
            "tax": Object {
              "rate": 0,
            },
          },
          "type": "one_time",
        },
        Object {
          "amount_subtotal": 17,
          "amount_tax": 3,
          "amount_total": 20,
          "billing_period": "monthly",
          "tax": Object {
            "amount": 3,
            "tax": Object {
              "_id": "79cac814-18c8-4047-ae45-1d0828598a18",
              "rate": 19,
              "type": "Custom",
            },
          },
          "type": "recurring",
        },
      ],
      "taxes": Array [
        Object {
          "amount": 0,
          "tax": Object {
            "rate": 0,
          },
        },
        Object {
          "amount": 3,
          "tax": Object {
            "_id": "79cac814-18c8-4047-ae45-1d0828598a18",
            "rate": 19,
            "type": "Custom",
          },
        },
      ],
    },
  },
}
`;

exports[`computePriceItemDetails computes the pricing details for a simple price 1`] = `
Object {
  "amount_subtotal": 331704,
  "amount_tax": 63024,
  "amount_total": 394728,
  "currency": "EUR",
  "items": Array [
    Object {
      "_price": Object {
        "_id": "price#1",
        "_title": "Winter Sale",
        "description": "Winter Sale",
        "is_tax_inclusive": true,
        "pricing_model": "per_unit",
        "tax": Array [
          Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        ],
        "type": "one_time",
        "unit_amount": 78946,
        "unit_amount_currency": "EUR",
        "unit_amount_decimal": "789.456224456678",
      },
      "_product": Object {
        "_tags": Array [
          "product-tag-1",
          "product-tag-2",
        ],
      },
      "amount_subtotal": 331704,
      "amount_subtotal_decimal": "3317.04295990201",
      "amount_tax": 63024,
      "amount_total": 394728,
      "amount_total_decimal": "3947.28112228339",
      "currency": "EUR",
      "description": "Winter Sale",
      "is_tax_inclusive": true,
      "price_id": "price#1",
      "pricing_model": "per_unit",
      "product_id": "prod-id#12324",
      "quantity": 5,
      "taxes": Array [
        Object {
          "amount": 63024,
          "tax": Object {
            "_created_at": "2022-06-29T20:26:19.020Z",
            "_id": "19",
            "_org": "739224",
            "_schema": "tax",
            "_title": "",
            "_updated_at": "2022-06-29T20:26:19.020Z",
            "rate": 19,
            "type": "VAT",
          },
        },
      ],
      "unit_amount": 78946,
      "unit_amount_decimal": "789.456224456678",
      "unit_amount_gross": 78946,
      "unit_amount_gross_decimal": "789.456224456678",
      "unit_amount_net": 66341,
      "unit_amount_net_decimal": "663.408591980402",
    },
  ],
  "total_details": Object {
    "amount_tax": 63024,
    "breakdown": Object {
      "recurrences": Array [
        Object {
          "amount_subtotal": 331704,
          "amount_subtotal_decimal": "3317.04295990201",
          "amount_tax": 63024,
          "amount_total": 394728,
          "amount_total_decimal": "3947.28112228339",
          "type": "one_time",
          "unit_amount_gross": 78946,
          "unit_amount_net": 66341,
        },
      ],
      "recurrencesByTax": Array [
        Object {
          "amount_subtotal": 331704,
          "amount_tax": 63024,
          "amount_total": 394728,
          "tax": Object {
            "amount": 63024,
            "tax": Object {
              "_id": "19",
              "rate": 19,
              "type": "VAT",
            },
          },
          "type": "one_time",
        },
      ],
      "taxes": Array [
        Object {
          "amount": 63024,
          "tax": Object {
            "_id": "19",
            "rate": 19,
            "type": "VAT",
          },
        },
      ],
    },
  },
}
`;
